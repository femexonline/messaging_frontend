(()=>{"use strict";var __webpack_modules__={109:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Ko:()=>getSeparatorPattern,ST:()=>rearrangeSeparatorArr,dL:()=>getDatePattern,y$:()=>getDatePatternFull});const PATTERN="\\byyyy\\b|\\byy\\b|\\by\\b|\\bmmmm\\b|\\bmmm\\b|\\bmm\\b|\\bmmb\\b|\\bm\\b|\\bDDDD\\b|\\bDDD\\b|\\bD\\b|\\bdtH\\b|\\bdTH\\b|\\bd\\b|\\bdb\\b|\\bh\\b|\\bhb\\b|\\bi\\b|\\bib\\b|\\bs\\b|\\bsb\\b|\\bapM\\b|\\baPM\\b",getDatePatternFull=()=>{let datePatternFull;return datePatternFull="/\\b("+PATTERN+"\\b)/",datePatternFull=eval(datePatternFull),datePatternFull},getDatePattern=()=>{let datePattern;return datePattern="/\\b"+PATTERN+"\\b/",datePattern=eval(datePattern),datePattern},getSeparatorPattern=separatorArr=>{let separatorPatternBefor=separatorArr;separatorPatternBefor.sort(((e,t)=>t.length-e.length));let separatorPattern="";return separatorPatternBefor.forEach((e=>{separatorPattern&&(separatorPattern+="|"),separatorPattern+=e})),separatorPattern="/"+separatorPattern+"/",separatorPattern=eval(separatorPattern),separatorPattern},rearrangeSeparatorArr=(e,t)=>{let s=[];return e.forEach((e=>{t.indexOf(e)>-1&&s.push(e)})),s}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var s=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](s,s.exports,__webpack_require__),s.exports}__webpack_require__.d=(e,t)=>{for(var s in t)__webpack_require__.o(t,s)&&!__webpack_require__.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var __webpack_exports__={};const chatsPerAPICall=null,messagesPerAPICall=null;class _ErrorReport{static get status(){return 2}}class _ApiSettings{static get chatsPerAPICall(){return 15}static get messagesPerAPICall(){return 20}}class _MessageOptions{static get replyMessage(){return 1}static get messageInfo(){return 1}static get fowardMessage(){return 1}static get starMessage(){return 1}static get deleteMessage(){return 1}static get selectMessage(){return 1}static get copyMessage(){return 1}static get headReplyMessage(){return 1&_MessageOptions.replyMessage}static get headMsgInfo(){return 1&_MessageOptions.messageInfo}static get groupFowardMessage(){return 1&_MessageOptions.fowardMessage}static get groupStarMessage(){return 1&_MessageOptions.starMessage}static get groupDelMessage(){return 1&_MessageOptions.deleteMessage}static get groupCopyMessage(){return 1&_MessageOptions.copyMessage}}class _ChatOptions{static get selectChat(){return 1}static get deleteChat(){return 1}static get pinChat(){return 1}static get groupChatPin(){return _ChatOptions.pin&&1}static get groupDelChat(){return _ChatOptions.deleteChat&&1}}class Settings{static get ErrorReport(){return _ErrorReport}static get ApiSettings(){return _ApiSettings}static get MessageOptions(){return _MessageOptions}static get ChatOptions(){return _ChatOptions}}const alertMsg=e=>{let t="There seam to be an error, please contact the Admin is this message persist";return e&&(t=`Error ${e}, please contact the Admin is this error persist`),t},errorReportStatus=Settings.ErrorReport.status,userIsAlerted={},allowUserAlert={};class MyCodeErr{static announce(e,t,s=!1,a=!1){if(a)return 3===errorReportStatus?(console.log(t),e):void 0;if(0!==errorReportStatus){if(1===errorReportStatus){clearTimeout(allowUserAlert[e]);let s=alertMsg(t);return alert(s),void(allowUserAlert[e]=setTimeout((()=>{userIsAlerted[e]=!1}),2e3))}return 2===errorReportStatus?(console.log(t),e):void 0}}}class DOMGetter{static getPageSection(){return document.getElementById("pageSection")}static getLoaderBackgroundElem(e){return e.getElementsByClassName("loaderBackground")[0]}static getContentLoaderElem(e){return e.getElementsByClassName("contentLoader")[0]}static getMousePositionBody(){return document.getElementById("mousePositionBody")}static getShowProfilePicture(){return document.getElementById("showProfilePicture")}static getDeleteMessageOption(){return document.getElementById("deleteMessageOption")}static getDeleteChatOption(){return document.getElementById("deleteChatOption")}static getMsgInfoPopUp(){return document.getElementById("msgInfoPopUp")}static getChat(){return document.getElementById("chat")}static getChatMousePosBody(){return document.getElementById("chatMousePosBody")}static getChatHead(){return document.getElementById("chatHead")}static getChatHeadNormal(){return document.getElementById("chatHeadNormal")}static getChatChatMinimize(){return document.getElementById("chatChatMinimize")}static getChatHeadPix(){return document.getElementById("chatHeadPix")}static getChatHeadChat(){return document.getElementById("chatHeadChat")}static getChatHeadSearchChat(){return document.getElementById("chatHeadSearchChat")}static getChatHeadOthers(){return document.getElementById("chatHeadOthers")}static getChatHeadOthersOptions(){return document.getElementById("chatHeadOthersOptions")}static getChatHeadSelected(){return document.getElementById("chatHeadSelected")}static getChatHeadBack(){return document.getElementById("chatHeadBack")}static getChatHeadCount(){return document.getElementById("chatHeadCount")}static getChatHeadPin(){return document.getElementById("chatHeadPin")}static getChatHeadDelete(){return document.getElementById("chatHeadDelete")}static getChatHeadOthersS(){return document.getElementById("chatHeadOthersS")}static getChatSearch(){return document.getElementById("chatSearch")}static getChatSearchBack(){return document.getElementById("chatSearchBack")}static getChatSearchClear(){return document.getElementById("chatSearchClear")}static getChatBody(){return document.getElementById("chatBody")}static getGetOlderChat(){return document.getElementById("getOlderChat")}static getMessage(){return document.getElementById("message")}static getShowChatBox(){return document.getElementById("showChatBox")}static getMessageHead(){return document.getElementById("messageHead")}static getMessageHeadNormal(){return document.getElementById("messageHeadNormal")}static getMessageChatMaximize(){return document.getElementById("messageChatMaximize")}static getMessageHeadPix(){return document.getElementById("messageHeadPix")}static getMessageHeadOthers(){return document.getElementById("messageHeadOthers")}static getMessageHeadOthersOptions(){return document.getElementById("messageHeadOthersOptions")}static getMessageHeadSelected(){return document.getElementById("messageHeadSelected")}static getMessageHeadBack(){return document.getElementById("messageHeadBack")}static getMessageHeadCount(){return document.getElementById("messageHeadCount")}static getMessageHeadReply(){return document.getElementById("messageHeadReply")}static getMessageHeadDelete(){return document.getElementById("messageHeadDelete")}static getMessageHeadFoward(){return document.getElementById("messageHeadFoward")}static getMessageHeadCopy(){return document.getElementById("messageHeadCopy")}static getMessageHeadStar(){return document.getElementById("messageHeadStar")}static getMessageHeadInfo(){return document.getElementById("messageHeadInfo")}static getMessageHeadOthersS(){return document.getElementById("messageHeadOthersS")}static getMessageBody(){return document.getElementById("messageBody")}static getMsgSelectAChat(){return document.getElementById("selectAChatW")}static getLoadOlderMsgsBtn(){return document.getElementById("loadOlderMsgsBtn")}static getChatBox(){return document.getElementById("chatBox")}static getMsgDate(){return document.getElementById("msgDate")}static getCloseChatBox(){return document.getElementById("closeChatBox")}static getChatBoxTextMsg(){return document.getElementById("chatBoxTextMsg")}static getMsgToSend(){return document.getElementById("msgToSend")}static getMsgToBeReplyedID(){return document.getElementById("msgToBeReplyedID")}}class GlobalVarsInstance{constructor(){this.selectedChatsID=[],this.selectedMessagesID=[],this.msgSenderTracking=[],this.msgstaredTracking=[],this.chatsAreSelected=null,this.megChatTouchedTimeOut=null,this.touchYPos=null,this.megBdScrlTop=null,this.msgDateTimeOutFunction=null}}const GlobalVars=new GlobalVarsInstance;class PageClearDOM{static section(){let e=DOMGetter.getPageSection().children;if(e){let t=e.length;for(let s=0;s<t;s++)e[0].parentNode.removeChild(e[0])}else{let e="allSectionContent not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}}class PageCreateDOM{static messagesPage(){const e=[];let t=document.createElement("div");t.id="chat",t.className="chat",e.push(t);let s=document.createElement("div");return s.id="message",e.push(s),e}}const LBClass="loaderBackground",CLClass="contentLoader";class LoaderBackgroundDOM{static create(){let e=document.createElement("div");return e.className="loaderBackground",e}static append(e,t){e.appendChild(t)}static delete(e){let t=e.getElementsByClassName(LBClass)[0];if(t)if(t.parentNode==e)e.removeChild(t);else{let e="elem not a parent",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}else{let e="there is no background",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}}class ContentLoaderDOM{static create(e=null,t=null){if(!e&&!t){let e="noting for loader to work width",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}if(-1==["spiner","boxes"].indexOf(t)){let e="loader not recognised",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}let s=document.createElement("div");s.className="contentLoader";let a,n=document.createElement("div");if(e&&(!0===e&&(e="Loading"),a=document.createElement("span"),a.className="text",a.innerHTML=e,n.appendChild(a)),t){if("spiner"==t){let e=LodersDOM.createSpinerLoader();n.appendChild(e)}if("boxes"==t){let e=LodersDOM.createBoxesLoader();n.appendChild(e)}}return s.appendChild(n),s}static append(e,t){e.appendChild(t)}static delete(e){let t=e.getElementsByClassName(CLClass)[0];if(t)if(t.parentNode==e)e.removeChild(t);else{let e="elem not a parent",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}else{let e="there is no background",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}}class LodersDOM{static createSpinerLoader(){let e=document.createElement("span");return e.className="spiner",e}static createBoxesLoader(){let e,t=document.createElement("span");return t.className="boxes",e=document.createElement("span"),t.appendChild(e),e=document.createElement("span"),t.appendChild(e),e=document.createElement("span"),t.appendChild(e),t}}const Defaults={arrangement:"y-m-d h:i:s--apM",year:"yyyy",month:"mm",day:"DDDD",beforeTH:"<br>",afterTH:"</br>"},posibleDateFomatValues={year:["yyyy","yy","y"],month:["mmmm","mmm","mm","mmb","m"],day:["DDDD","DDD","D"],date:["dtH","dTH","d","db"],hour:["h","hb"],minute:["i","ib"],second:["s","sb"],midday:["apM","aPM"]},yearTextToYear=(e,t)=>("y"==t&&(t=Defaults.year,posibleDateFomatValues.year.indexOf(t)<0&&(t="yyyy"),"y"==t&&(t="yyyy")),"yyyy"==t?e:"yy"==t&&(e=String(e)).substr(-2)),monthNamesArr=[["January","Jan"],["February","Feb"],["March","Mar"],["April","Apr"],["May","May"],["June","Jun"],["July","Jul"],["August","Aug"],["September","Sep"],["October","Oct"],["November","Nov"],["December","Dec"]],monthTextToMonth=(e,t)=>("m"==t&&(t=Defaults.month,posibleDateFomatValues.month.indexOf(t)<0&&(t="mmmmm"),"m"==t&&(t="mmmmm")),"mmmm"==t?monthNamesArr[e][0]:"mmm"==t?monthNamesArr[e][1]:"mm"==t?++e:"mmb"==t&&(e++,String(e).length>1?e:"0"+e)),dayNamesArr=[["Sunday","Sun"],["Monday","Mon"],["Tuesday","Tue"],["Wednesday","Wed"],["Thursday","Thu"],["Friday","Fri"],["Saturday","Sat"]],dayTextToDay=(e,t)=>("D"==t&&(t=Defaults.day,posibleDateFomatValues.day.indexOf(t)<0&&(t="DDDD"),"D"==t&&(t="DDDD")),"DDDD"==t?dayNamesArr[e][0]:"DDD"==t&&dayNamesArr[e][1]),dateTextToDate=(e,t,s)=>{if("d"==t)return e;if("db"==t)return String(e).length>1?e:"0"+e;let a="th",n=(e=String(e)).split("").splice(-1);return 1==n&&(a="st"),2==n&&(a="nd"),3==n&&(a="rd"),"dtH"==t?(a=s.beforeTH+a+s.afterTH,e+=a):"dTH"==t&&(a=a.toUpperCase(),a=s.beforeTH+a+s.afterTH,e+=a)},hourTextToHour=(e,t,s)=>(s&&(0===e?e=12:e>12&&(e-=12)),"h"==t?String(e).length>1?e:"0"+e:"hb"==t&&e),minuteTextToMinute=(e,t)=>"i"==t?String(e).length>1?e:"0"+e:"ib"==t&&e,secondTextToSecond=(e,t)=>"s"==t?String(e).length>1?e:"0"+e:"sb"==t&&e,middayTextToMidday=(e,t)=>{let s="am";return e>11&&(s="pm"),"apM"==t?s:"aPM"==t&&(s=s.toUpperCase(),s)},fullDateTextToDate=(e,t,s,a)=>{const n=posibleDateFomatValues;if(n.year.indexOf(e)>-1){let s=t.getFullYear();return yearTextToYear(s,e)}if(n.month.indexOf(e)>-1){let s=t.getMonth();return monthTextToMonth(s,e)}if(n.day.indexOf(e)>-1){let s=t.getDay();return dayTextToDay(s,e)}if(n.date.indexOf(e)>-1){let s=t.getDate();return dateTextToDate(s,e,a)}if(n.hour.indexOf(e)>-1){let a=t.getHours();return hourTextToHour(a,e,s)}if(n.minute.indexOf(e)>-1){let s=t.getMinutes();return minuteTextToMinute(s,e)}if(n.second.indexOf(e)>-1){let s=t.getSeconds();return secondTextToSecond(s,e)}if(n.midday.indexOf(e)>-1){let s=t.getHours();return middayTextToMidday(s,e)}return!1};var patterns=__webpack_require__(109);const formatDate=(e=null,t=null,s=null)=>{if(s||(s={}),e||(e=Defaults.arrangement)||(e="y-m-d h:i:s--apM"),t||(t=new Date,s.isMiliseconds=!1,s.isPHPMicroSeconds=!1),s.isPHPMicroSeconds&&!0===s.isPHPMicroSeconds){if("number"!=typeof(t*=1e3)){let e="The date you choose is invalid";return alert(e),void console.log(e)}s.isMiliseconds=!0}if(s.isMiliseconds&&!0===s.isMiliseconds){if("number"!=typeof(t=parseInt(t))){let e="The date you choose is invalid";return alert(e),void console.log(e)}t=new Date(t)}if("object"!=typeof t){let e="The date you choose is invalid";return alert(e),void console.log(e)}s.beforeTH||(s.beforeTH=Defaults.beforeTH,null===s.beforeTH&&(s.beforeTH="")),s.afterTH||(s.afterTH=Defaults.afterTH,null===s.afterTH&&(s.afterTH=""));const a=/apM|aPM/.test(e),n=(0,patterns.y$)(),o=e.split(n);o.map(((e,t,s)=>{""==e&&s.splice(t,1)}));const l=(0,patterns.dL)(),r=e.split(l);r.map(((e,t,s)=>{""==e&&s.splice(t,1)}));const i=(0,patterns.Ko)(r),c=e.split(i);c.map(((e,t,s)=>{""==e&&s.splice(t,1)}));const d=c.map((e=>fullDateTextToDate(e,t,a,s))),g=(0,patterns.ST)(o,r);g.map(((e,t,s)=>{/--/.test(e)&&(s[t]=e.replace(/--/,""))}));let h="";if(l.test(o[0])){let e=0;d.forEach((t=>{h+=t,g[e]&&(h+=g[e]),e++}))}else{let e=0;g.forEach((t=>{h+=t,d[e]&&(h+=d[e]),e++}))}return h};class TimeFunctions{static generateTimeSentStringT1(e){let t,s=864e5,a=new Date;a.setHours(0,0,0),a=Date.parse(a);let n="db-mmb-yyyy";return e>=a-s&&(n=null,t="Yesterday"),e>=a&&(n=null,t="Today"),e>=a+s&&(n="db-mmb-yyyy"),n&&(t=formatDate(n,e,{isMiliseconds:!0})),t}static generateTimeSentStringT2(e){let t;return t=formatDate("h:i apM",e,{isMiliseconds:!0}),t}}class OtherFunctions{static clearMegChatTouchedTimeOut(e){clearTimeout(GlobalVars.megChatTouchedTimeOut),e.target.removeEventListener("touchend",OtherFunctions.clearMegChatTouchedTimeOut),e.target.removeEventListener("touchcancel",OtherFunctions.clearMegChatTouchedTimeOut),e.target.removeEventListener("touchmove",MsgBody.touchedThisMessageThenDrag),e.target.removeEventListener("touchmove",ChatBody.touchedThisChatThenDrag)}static activateMsgDateBeforeAfterfunc(){let e=document.getElementsByClassName("Be")[0],t=document.getElementsByClassName("Af")[0];e&&e.classList.remove("Be"),t&&t.classList.remove("Af");const s=OtherFunctions.getMsgDateBeforefunc(),a=OtherFunctions.getMsgDateAfterfunc();s&&s.classList.add("Be"),a&&a.classList.add("Af")}static getMsgDateBeforefunc(){const e=DOMGetter.getMessageBody();let t=e.getElementsByClassName("msgDate"),s=e.getBoundingClientRect().top,a=null;for(let e=0;e<t.length;e++){let n=t[e];if(!(n.getBoundingClientRect().top<s))return a;a=n}return a}static getMsgDateAfterfunc(){const e=DOMGetter.getMessageBody();let t=e.getElementsByClassName("msgDate"),s=e.getBoundingClientRect().top,a=null;for(let e=0;e<t.length;e++){let n=t[e];if(n.getBoundingClientRect().top>=s)return a=n,a}return a}static getMsgDateBeforeBeforefunc(e){let t=DOMGetter.getMessageBody().getElementsByClassName("msgDate"),s=null;for(let a=0;a<t.length;a++){let n=t[a];if(n.innerHTML==e)return s;s=n.innerHTML}return s}static onclickReplyedMegLink(e){let t=e.target;for(;"A"!=t.tagName;)t=t.parentElement;let s=t.parentElement;const a=ChatFuncs.getActiveChat(),n=s.dataset.id,o=MessageFuncs.getRepliedMsgObj(a,n);if(!o){let e="Error getting replyedMsgObj",t="",s=MyCodeErr.announce(e,t,!0);return void(s&&console.log(s))}const l=MsgBody.makeMsgIDUsable(o.msgID);let r=document.getElementById(l);if(r)MsgBody.jumpToMsgByID(l,!0);else{if(MessageFuncs.pushInPreviousMsgs(a,l),r=document.getElementById(l),!r){let e="Error jumping",t="",s=MyCodeErr.announce(e,t,!0);return void(s&&console.log(s))}MsgBody.jumpToMsgByID(l,!0)}}}class ProfileFunc{static viewMyProfilePicture(){const e=DOMGetter.getChatHeadPix();let t=DOMGetter.getMousePositionBody(),s=DOMGetter.getShowProfilePicture();t&&MousePositionBodyPopupDOM.delete(),s&&ShowProfilePicturePopupDOM.delete();let a=e.getElementsByTagName("img")[0].src;MousePositionBodyPopupDOM.append(MousePositionBodyPopupDOM.create({styles:[["background","black"],["opacity","0.5"]]})),ShowProfilePicturePopupDOM.append(ShowProfilePicturePopupDOM.create(a))}static viewCurrentChatProfilePicture(){const e=DOMGetter.getMessageHeadPix();let t=DOMGetter.getMousePositionBody(),s=DOMGetter.getShowProfilePicture();t&&MousePositionBodyPopupDOM.delete(),s&&ShowProfilePicturePopupDOM.delete();let a=e.getElementsByTagName("img")[0].src;MousePositionBodyPopupDOM.append(MousePositionBodyPopupDOM.create({styles:[["background","black"],["opacity","0.5"]]})),ShowProfilePicturePopupDOM.append(ShowProfilePicturePopupDOM.create(a))}static viewChatProfilePicture(e){let t=DOMGetter.getMousePositionBody(),s=DOMGetter.getShowProfilePicture();t&&MousePositionBodyPopupDOM.delete(),s&&ShowProfilePicturePopupDOM.delete();let a=e.target.src;MousePositionBodyPopupDOM.append(MousePositionBodyPopupDOM.create({styles:[["background","black"],["opacity","0.5"]]})),ShowProfilePicturePopupDOM.append(ShowProfilePicturePopupDOM.create(a))}static closeProfilePictureView(){const e=DOMGetter.getMousePositionBody(),t=DOMGetter.getShowProfilePicture();e&&MousePositionBodyPopupDOM.delete(),t&&ShowProfilePicturePopupDOM.delete()}}class MsgSectionDOM{static clear(e=!1){let t=DOMGetter.getMessage().children;if(t){let e=t.length;for(let s=0;s<e;s++)t[0].parentNode.removeChild(t[0]);ChatFuncs.setActiveChat(null)}else{let e="msgSectionContent not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}e&&SelectAChatDOM.append(SelectAChatDOM.create())}static load(){MessageHeadDOM.append(MessageHeadDOM.create()),MessageHeadNormalDOM.append(MessageHeadNormalDOM.create()),MessageHeadSelectedDOM.append(MessageHeadSelectedDOM.create()),MsgDateDOM.append(MsgDateDOM.create(null,!0),!0),ShowChatBoxDOM.append(ShowChatBoxDOM.create()),MessageBodyDOM.append(MessageBodyDOM.create())}}class MessageBodyDOM{static create(){let e=document.createElement("div");e.id="messageBody";let t={messageBody:e};return OnloadActivations.messageBodyActivations(t),e}static append(e){const t=DOMGetter.getMessage();if(t)t.appendChild(e);else{let e="messageElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static clear(){let e=DOMGetter.getMessageBody().children;if(e){let t=e.length;for(let s=0;s<t;s++)e[0].parentNode.removeChild(e[0])}else{let e="msgBodyElems not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static appendElemBeforeElem(e,t){if(!e){let e="incomplete elements parameter",t="",s=!1,a=MyCodeErr.announce(e,t,s);return void(a&&console.log(a))}if(!t){let e="incomplete elements parameter",t="",s=!1,a=MyCodeErr.announce(e,t,s);return void(a&&console.log(a))}const s=t.parentElement;if(s)s.insertBefore(e,t);else{let e="elems parents dont match",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static markAsSelected(e,t){let s=e.getElementsByClassName("selected")[0],a=e.getElementsByClassName("Megchecked")[0],n=a.getElementsByTagName("input")[0];if(s){let e=s.dataset.id;MessageFuncs.msgIsDeleting(t,e)||s.classList.add("s")}if(a){let e=a.dataset.id;MessageFuncs.msgIsDeleting(t,e)||n.setAttribute("checked","true")}}}class MsgDateDOM{static create(e,t=!1){let s=document.createElement("div");return t?s.id="msgDate":(s.className="msgDate",s.innerHTML=e),s}static append(e,t=!1){let s=DOMGetter.getMessageBody();if(t&&(s=DOMGetter.getMessage()),s)s.appendChild(e);else{let e="msgBOdyElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static deleteFirstOnPage(){const e=document.getElementsByClassName("msgDate")[0];if(e)e.parentElement.removeChild(e);else{let e="firstMsgDateElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}}class MsgWraperDOM{static create(e){const t=e.replyedMegObj,s=MsgBody.makeMsgIDUsable(e.msgID),a=e.isSender;let n,o=e.first;n=a?"sent":"recieved",o=o?" first":"";let l=document.createElement("div");e.isDeleting?l.className="msgWrapperNotActive "+n+o:l.className="msgWrapper "+n+o,l.id=s,l.dataset.id=s;let r=document.createElement("div");r.className="selected hover",r.dataset.id=s,r.setAttribute("name",s),l.appendChild(r);let i=document.createElement("div");i.className="Megchecked";let c=document.createElement("input");c.type="checkbox",i.dataset.id=s,i.setAttribute("name",s),i.appendChild(c),l.appendChild(i);let d=MsgWraperDOM.createMsgContainerElem(e,o,n,t);return l.appendChild(d),MsgGroupActivations.allMessageOntouchEvent(l),MsgGroupActivations.allMegSelectMoreOptions(l),l}static append(e){const t=DOMGetter.getMessageBody();if(t)t.appendChild(e);else{let e="msgElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static replace(e,t){e=MsgBody.makeMsgIDUsable(e);const s=document.getElementById(e);if(!s){let e="msgElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);return void(a&&console.log(a))}const a=s.parentElement;if(a)a.replaceChild(t,s);else{let e="parents elems do not match",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static delete(e,t=!1){let s=e.msgID;if(s=MsgBody.makeMsgIDUsable(s),!s){let e="illegal first parameter",t="",s=!1,a=MyCodeErr.announce(e,t,s);return void(a&&console.log(a))}let a=document.getElementById(s);if(a){let s=a.parentNode;if(t)s.removeChild(a);else{let t=DeletedMsgDOM.create(e);s.replaceChild(t,a)}}else{let e="msgBodyDOM not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static createMsgContainerElem(e,t,s,a){const n=MsgBody.makeMsgIDUsable(e.msgID),o=e.msg,l=e.isSender,r=e.timeSentString,i=e.read,c=e.stared;let d=document.createElement("div");d.className="messageContainer "+s+t,d.dataset.id=n,d.setAttribute("name",n);let g=document.createElement("div");g.className="megMore",g.dataset.id=n,g.setAttribute("name",n);let h=document.createElement("span");if(h.className="material-icons subMsgMore",h.dataset.id=n,h.setAttribute("name",n),h.innerHTML="expand_more",g.appendChild(h),d.appendChild(g),a){let e=MsgWraperDOM.createReplyedMegElem(n,a);d.appendChild(e)}let M=document.createElement("p");M.className="message",M.innerHTML=o,d.appendChild(M);let m=MsgWraperDOM.createTimeContainElem(r,i,c,l);return d.appendChild(m[0]),d.appendChild(m[1]),d}static createReplyedMegElem(e,t){let s,a,n,o;a=t.isSender,a?(o="You",s="you"):(o=t.senderName,s="notYou"),n=t.msg,e=MsgBody.makeMsgIDUsable(e);let l=document.createElement("div");l.className="replyedMeg",l.dataset.id=e,l.setAttribute("name",e);let r=document.createElement("div");l.appendChild(r);let i=document.createElement("span");i.className=s,l.appendChild(i);let c=document.createElement("a");i=document.createElement("span"),i.className=s,i.innerHTML=o,c.appendChild(i);let d=document.createTextNode(n);return c.appendChild(d),l.appendChild(c),c.addEventListener("click",OtherFunctions.onclickReplyedMegLink),l}static createTimeContainElem(e,t,s,a){const n=Settings.MessageOptions;let o=[];let l=document.createElement("span");l.className="timeContainPlaceholder timeContain";let r,i=document.createElement("span");return i.className="timeContain",n.starMessage&&s&&(r=StarDOM.create(),l.appendChild(r),r=r.cloneNode(!0),i.appendChild(r)),r=document.createElement("span"),r.className="time",r.innerHTML=e,l.appendChild(r),r=r.cloneNode(!0),i.appendChild(r),a&&(r=document.createElement("span"),r.className="material-icons seen","read"==t&&r.classList.add({sent:"",delivered:"",read:"read"}[t]),r.innerHTML={sent:"done",delivered:"done_all",read:"done_all"}[t],l.appendChild(r),r=r.cloneNode(!0),i.appendChild(r)),o[0]=l,o[1]=i,o}static makeSelectable(e,t){if(!ChatFuncs.isActiveChat(e)){let e="chat no longer active",t="",s=MyCodeErr.announce(e,t,!1,!0);return void(s&&console.log(s))}t=MsgBody.makeMsgIDUsable(t);let s=document.getElementById(t);if(s)s.classList.remove("msgWrapperNotActive"),s.classList.add("msgWrapper");else{let e="error with msgWrapper",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static makeUnselectable(e,t){if(!ChatFuncs.isActiveChat(e)){let e="chat no longer active",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}t=MsgBody.makeMsgIDUsable(t);let s=document.getElementById(t);if(s)s.classList.remove("msgWrapper"),s.classList.add("msgWrapperNotActive");else{let e="error with msgWrapper",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static isSelectable(e){return!!e.classList.contains("msgWrapper")}}class MsgSendingWraperDOM{static create(e){const t=e.rMsg,s=e.msgSendingID;let a="sent",n=document.createElement("div");n.className="msgSendingWrapper "+a,n.id=s,n.dataset.id=s;let o=MsgSendingWraperDOM.createMsgContainerElem(e,a,t);return n.appendChild(o),n}static append(e){const t=DOMGetter.getMessageBody();if(t)t.appendChild(e);else{let e="msgBodyElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static delete(e){if(!e){let e="incomplete parameter",t="",s=!1,a=MyCodeErr.announce(e,t,s);return void(a&&console.log(a))}let t=document.getElementById(e);if(t)t.parentNode.removeChild(t);else{let e="msgBody not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static createMsgContainerElem(e,t,s){const a=e.msgSendingID,n=e.msg;let o=document.createElement("div");if(o.className="msgSendingContainer "+t,o.dataset.id=a,o.setAttribute("name",a),s){let e=MsgWraperDOM.createReplyedMegElem(a,s);o.appendChild(e)}let l=document.createElement("p");l.className="message",l.innerHTML=n,o.appendChild(l);let r=MsgSendingWraperDOM.createTimeContainElem();return o.appendChild(r[0]),o.appendChild(r[1]),o}static createTimeContainElem(){let e=[],t=document.createElement("span");t.className="timeContainPlaceholder timeContain";let s=document.createElement("span");s.className="timeContain";let a=document.createElement("span");return a.className="material-icons msgSending",a.innerHTML="query_builder",t.appendChild(a),a=a.cloneNode(!0),s.appendChild(a),e[0]=t,e[1]=s,e}static convertToMsg(e,t){const s=document.getElementById(e);if(!s){let e="msgSending elem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);return void(a&&console.log(a))}const a=s.parentElement;if(a)a.replaceChild(t,s);else{let e="parent elem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}}class DeletedMsgDOM{static create(e){let t=e.isSender,s=e.first,a=e.deletedText;if(null==t||null==s){let e="Incomplete parameter",t="",s=!1,a=MyCodeErr.announce(e,t,s);return void(a&&console.log(a))}t=t?"sent":"recieved",s=s?" first":"";let n=document.createElement("div");n.className="msgWrapper "+t+s;let o=document.createElement("div");return o.className="delMsgContainer "+t+s,o.innerHTML=a,n.appendChild(o),n}static append(e){const t=DOMGetter.getMessageBody();if(t)t.appendChild(e);else{let e="msgBodyElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}}class StarDOM{static create(){let e=document.createElement("span");return e.className="material-icons stared",e.innerHTML="grade",e}static append(e,t){e=MsgBody.makeMsgIDUsable(e);let s=document.getElementById(e);if(s){let e=s.getElementsByClassName("timeContain");for(let s=0;s<e.length;s++){let a=e[s].children[0];e[s].insertBefore(t,a),t=t.cloneNode(!0)}}else{let e="msgBodyElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static delete(e){e=MsgBody.makeMsgIDUsable(e);let t=document.getElementById(e);if(t){let e=t.getElementsByClassName("stared"),s=e.length;for(let t=0;t<s;t++)e[0].parentNode.removeChild(e[0])}else{let e="msgBodyElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}}class MsgMoreOptionsDOM{static create(e,t=null){e=MsgBody.makeMsgIDUsable(e);const s=Settings.MessageOptions;t||(t=ChatFuncs.getActiveChat());const a=MessageFuncs.getMessageObj(t,e),n=a.stared,o=a.isSender;let l;l=n?"Unstar":"Star";const r=document.createElement("div");r.className="megMoreOptions",r.dataset.id=e,r.setAttribute("name",e);let i=[];s.replyMessage&&i.push(["replyThisMessage","Reply"]),s.messageInfo&&i.push(["thisMessageInfo","Info"]),s.fowardMessage&&i.push(["fowardThisMessage","Foward"]),s.starMessage&&i.push(["starThisMessage",l]),s.deleteMessage&&i.push(["deleteThisMessage","Delete"]),s.selectMessage&&i.push(["selectThisMessage","Select"]),i.forEach((e=>{let t=!0;if("thisMessageInfo"!=e[0]||o||(t=!1),t){let t=document.createElement("p");t.className=e[0],t.innerHTML=e[1],r.appendChild(t)}})),MsgMoreOptionsDOM.onload(r,t,e);const c=document.createElement("div");return c.className="megMoreOptionsBackground",c.dataset.id=e,c.setAttribute("name",e),c.appendChild(r),c}static append(e,t){e=MsgBody.makeMsgIDUsable(e);const s=document.getElementById(e);if(s){const e=s.getElementsByClassName("megMore")[0],a=e.parentElement,n=e.nextElementSibling;n?a.insertBefore(t,n):a.appendChild(t)}}static delete(e,t=!1){let s;if(t)s=e;else{e=MsgBody.makeMsgIDUsable(e);const t=document.getElementById(e);if(t){if(s=t.getElementsByClassName("megMoreOptionsBackground")[0],!s){let e="msgMoreOptionElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);return void(a&&console.log(a))}}else{let e="msgWrapperElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}s.parentElement.removeChild(s)}static onload(e,t,s){const a=e.getElementsByClassName("selectThisMessage")[0],n=e.getElementsByClassName("replyThisMessage")[0],o=e.getElementsByClassName("thisMessageInfo")[0],l=e.getElementsByClassName("fowardThisMessage")[0],r=e.getElementsByClassName("starThisMessage")[0],i=e.getElementsByClassName("deleteThisMessage")[0];a&&a.addEventListener("click",MsgOptions.selectThisMessage),n&&n.addEventListener("click",MsgOptions.replyThisMessage),o&&o.addEventListener("click",MsgOptions.getThisMessageInfo),l&&l.addEventListener("click",MsgOptions.fowardThisMessage),r&&(MessageFuncs.msgIsDeleting(t,s)?MsgMoreOptionsDOM.makeOptionUclickale(0,0,0,r):r.addEventListener("click",MsgOptions.starThisMessage)),i&&(MessageFuncs.msgIsDeleting(t,s)?MsgMoreOptionsDOM.makeOptionUclickale(0,0,0,i):i.addEventListener("click",MsgOptions.deleteThisMessage))}static makeOptionUclickale(e,t,s,a){if(!a){if(t=MsgBody.makeMsgIDUsable(t),!ChatFuncs.isActiveChat(e)){let e="chat no longer active",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}const n={reply:"replyThisMessage",info:"thisMessageInfo",fow:"fowardThisMessage",star:"starThisMessage",del:"deleteThisMessage",sel:"selectThisMessage"};let o=document.getElementById(t);if(!o){let e="msgContainDOM not found",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}if(!o.getElementsByClassName("megMoreOptions")[0])return;a=megMoreOptions.getElementsByClassName(n[s])[0]}a&&(a.classList.add("processing"),a.classList.contains("replyThisMessage")&&a.removeEventListener("click",MsgOptions.replyThisMessage),a.classList.contains("thisMessageInfo")&&a.removeEventListener("click",MsgOptions.getThisMessageInfo),a.classList.contains("fowardThisMessage")&&a.removeEventListener("click",MsgOptions.fowardThisMessage),a.classList.contains("starThisMessage")&&a.removeEventListener("click",MsgOptions.starThisMessage),a.classList.contains("deleteThisMessage")&&a.removeEventListener("click",MsgOptions.deleteThisMessage),a.classList.contains("selectThisMessage")&&a.removeEventListener("click",MsgOptions.selectThisMessage))}static makeOptionClickale(e,t,s,a){if(ChatFuncs.isActiveChat(e)){if(!a){const e={reply:"replyThisMessage",info:"thisMessageInfo",fow:"fowardThisMessage",star:"starThisMessage",del:"deleteThisMessage",sel:"selectThisMessage"};t=MsgBody.makeMsgIDUsable(t);let n=document.getElementById(t);if(!n){let e="msgContainDOM not found",t="",s=MyCodeErr.announce(e,t,!1,!0);return void(s&&console.log(s))}if(!n.getElementsByClassName("megMoreOptions")[0])return;a=megMoreOptions.getElementsByClassName(e[s])[0]}a&&(a.classList.remove("processing"),a.classList.contains("replyThisMessage")&&a.addEventListener("click",MsgOptions.replyThisMessage),a.classList.contains("thisMessageInfo")&&a.addEventListener("click",MsgOptions.getThisMessageInfo),a.classList.contains("fowardThisMessage")&&a.addEventListener("click",MsgOptions.fowardThisMessage),a.classList.contains("starThisMessage")&&a.addEventListener("click",MsgOptions.starThisMessage),a.classList.contains("deleteThisMessage")&&a.addEventListener("click",MsgOptions.deleteThisMessage),a.classList.contains("selectThisMessage")&&a.addEventListener("click",MsgOptions.selectThisMessage))}else{let e="chat no longer active",t="",s=MyCodeErr.announce(e,t,!1,!0);s&&console.log(s)}}}class LoadOlderMsgsBtnDOM{static create(){let e=document.createElement("div");return e.id="loadOlderMsgsBtn",e.innerHTML="Older Messages",LoadOlderMsgsBtnDOM.onload(e),e}static append(e){const t=DOMGetter.getMessageBody();if(DOMGetter.getLoadOlderMsgsBtn()){let e="loadOlderMsgsBtnElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);return void(a&&console.log(a))}if(!t){let e="msgBodyElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);return void(a&&console.log(a))}const s=t.firstChild;if(s)t.insertBefore(e,s);else{let e="error getting positioning",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static delete(){const e=DOMGetter.getMessageBody(),t=DOMGetter.getLoadOlderMsgsBtn();if(t)if(e)e.removeChild(t);else{let e="msgBodyElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}else{let e="loadOlderMsgsBtnElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static onload(e){e.addEventListener("click",LoadOlderMsgsBtnDOM.onclick)}static onclick(){const e=ChatFuncs.getActiveChat();MessageFuncs.pushInPreviousMsgs(e)}}class SelectAChatDOM{static create(){let e=document.createElement("div");e.className="selectAChatW",e.id="selectAChatW";let t=document.createElement("div");t.className="selectAChat",t.innerHTML="Slect a chat",e.appendChild(t);let s=document.createElement("div");return s.className="selectAChatBtn",s.innerHTML="Chats",e.appendChild(s),s.addEventListener("click",MessageHeadNormalDOM.onclickMessageChatMaximizeBotton),e}static append(e){const t=DOMGetter.getMessage();if(t)t.appendChild(e);else{let e="messageElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static delete(){MsgSectionDOM.clear()}}class UpdateMsgDOM{static starElem(e,t){if(t=MsgBody.makeMsgIDUsable(t),!ChatFuncs.isActiveChat(e))return;const s=document.getElementById(t);if(!s)return;const a=s.getElementsByClassName("messageContainer")[0].getElementsByClassName("stared")[0];MessagesDB.getStaredStatus(e,t)?a||StarDOM.append(t,StarDOM.create()):a&&StarDOM.delete(t)}static readElem(e,t){t=MsgBody.makeMsgIDUsable(t);const s=ChatBody.makeChatID_DB_Usable(e);if(!ChatFuncs.isActiveChat(s))return;if(!MessagesDB.userIsSender(s,t))return;const a=document.getElementById(t);if(!a)return;const n={sent:"done",delivered:"done_all",read:"done_all"},o={sent:"",delivered:"",read:"read"},l=a.getElementsByClassName("messageContainer")[0].getElementsByClassName("seen"),r=MessagesDB.getReadStatus(s,t);for(let e=0;e<l.length;e++){const t=t[e];t.className.remove(o.read),t.className.add(o[r]),t.innerHTML=n[r]}if({chatID:s,msgID:t}==MessagesDB.msgInfoInView){const e=getMsgInfoPopUp();if(e){const a=e.getElementsByClassName("messageContainer")[0].getElementsByClassName("seen"),l=MessagesDB.getReadStatus(s,t);for(let e=0;e<a.length;e++){const t=t[e];t.className.remove(o.read),t.className.add(o[l]),t.innerHTML=n[l]}}}}static deletedMsgElem(e,t){if(!ChatFuncs.isActiveChat(e))return;if(!document.getElementById(t))return;if(!MessagesDB.getMsgDelStatus(e,t))return;let s=MessagesDB.getMsgInstance(e,t);MsgWraperDOM.delete(s)}static messageHeadLastSeenElem(e){if(!ChatFuncs.isActiveChat(e))return;const t=ChatFuncs.getChatLastSeenString(e);document.getElementById("messageHeadNameTime")&&MessageHeadNormalDOM.deleteLastSeen(),t&&MessageHeadNormalDOM.appendLastSeen(MessageHeadNormalDOM.createLastSeen(t))}}class ProfileAPI{static fetchMyProfile(){return GenerateDummyDatabase.profile(["2a"])}}class ProfileInstance{constructor(e){e||(e={}),this._userID=e.userID,this._chatID=e.chatID,this._name=e.name,this._p_pix=e.p_pix,this._lastSeen=null}get userID(){return this._userID}get chatID(){return this._chatID}get name(){return this._name}get p_pix(){return this._p_pix}get lastSeen(){return this._lastSeen}set userID(e){}set chatID(e){}set name(e){this._name=e}set p_pix(e){this._p_pix=e}set lastSeen(e){this._lastSeen=e||null}}class MyProfileInstance extends ProfileInstance{constructor(){super()}async fetch(){let e=await ProfileAPI.fetchMyProfile();this._userID=e.userID,this.name=e.name,this.p_pix=e.p_pix}}class ProfilesDBInstance{constructor(){this._profiles={}}get profiles(){return this._profiles}set profiles(e){}addProfile(e){this.profiles[e.userID]=new ProfileInstance(e)}setP_pix(e,t){this.profiles[e].p_pix=t}setName(e,t){this.profiles[e].name=t}setLastSeen(e,t){this.profiles[e].lastSeen=t}getP_pix(e){return this.profiles[e].p_pix}getName(e){return this.profiles[e].name}getLastSeen(e){return this.profiles[e].lastSeen}isOnline(e){return"online"==this.profiles[e].lastSeen}profileObjIsAvailable(e){let t=this.profiles[e];return!!t&&!!t.userID}recieveLastSeenSignalTestForAllProfiles(){}recieveLastSeenSignal(e,t){const s=this.profiles[e].chatID;this.setLastSeen(e,t),ChatFuncs.updateChatLastSeen(s)}recieveNameChangeSignal(e,t){const s=this.profiles[e].chatID;this.setName(e,t),ChatFuncs.updateChatName(s)}recieveP_pixChangeSignal(e,t){const s=this.profiles[e].chatID;this.setP_pix(e,t),ChatFuncs.updateChatImage(s)}}const MyProfile=new MyProfileInstance,ProfilesDB=new ProfilesDBInstance;class MsgApis{static async fetchOldMsgs(e,t,s,a){let n;if(t){let e=[.1,.2,.3,.4,.5,.6,.7,.8,.9,.1,.11,.12,.13,.14,.15,.16,.17,.18,.19];n=await GenerateDummyDatabase.messages(chatID_DB,e,!1,!0)}else{let t=[.1,.2,.3,.4,.5,.6,.7,.8,.9,.1,.11,.12,.13,.14,.15,.16,.17,.18,.19];n=await GenerateDummyDatabase.messages(e,t,!1,!0)}return n}static starMsg(e,t){let s=[];if(t.forEach((t=>{MessageFuncs.msgIsStaring(e,t)||(MessageFuncs.setMsgIsStaring(e,t,!0),MsgMoreOptionsDOM.makeOptionUclickale(e,t,"star"),s.push(t))})),!s.length)return void console.log("err");let a=GenerateAPIRes.starMsgRes(e,s);a?ApiSuccess.starMsg(a):ApiFail.starMsg(e,s)}static deleteMsg(e,t,s){let a=[];if(t.forEach((t=>{MessageFuncs.msgIsDeleting(e,t)||(MessageFuncs.setMsgIsDeleting(e,t,!0),MsgMoreOptionsDOM.makeOptionUclickale(e,t,"del"),MsgWraperDOM.makeUnselectable(e,t),a.push(t))})),!a.length)return void console.log("err");let n=GenerateAPIRes.deleteMessageRes(e,a,s);n?ApiSuccess.deleteMsg(n):ApiFail.deleteMsg(e,a)}}class ApiSuccess{static starMsg(e){let t=e.chatID;e.result.forEach((e=>{let s=e.msgID,a=e.starStatus;MessageFuncs.setMsgIsStaring(t,s,!1),MsgMoreOptionsDOM.makeOptionClickale(t,"star"),MessageFuncs.updateStaredStatus(t,s,a)}))}static deleteMsg(e){let t=e.chatID;e.delCodeNoArr.forEach((e=>{let s=e.msgID,a=e.delCodeNo;a?MessageFuncs.deleteMessage(t,s,a):(MessageFuncs.setMsgIsDeleting(t,s,!1),MsgMoreOptionsDOM.makeOptionClickale(t,s,"del"),MsgWraperDOM.makeSelectable(t,s),alert("chat not deleted"),console.log("chat not deleted"))}))}}class ApiFail{static starMsg(e,t){t.forEach((t=>{MessageFuncs.setMsgIsStaring(e,t,!1),MsgMoreOptionsDOM.makeOptionClickale(e,"star")}));let s=MyCodeErr.announce("Poor internet connection","");s&&console.log(s)}static deleteMsg(e,t){t.forEach((t=>{MessageFuncs.setMsgIsDeleting(e,t,!1),MsgMoreOptionsDOM.makeOptionClickale(e,t,"del"),MsgWraperDOM.makeSelectable(e,t)}));let s=MyCodeErr.announce("Poor internet connection","");s&&console.log(s)}}class MsgHeadSelecOpts{static replyMessages(){if(GlobalVars.selectedMessagesID.length>1){let e="please select only one message",t="",s=MyCodeErr.announce(e,t,!0);return void(s&&console.log(s))}if(!GlobalVars.selectedMessagesID.length){let e="no message selected",t="",s=MyCodeErr.announce(e,t,!0);return void(s&&console.log(s))}let e=GlobalVars.selectedMessagesID[0];MsgOptions.replyThisMessage(e),MsgGroupDeactivations.allSelected_Megchecked()}static deleteMessages(){let e=DOMGetter.getMousePositionBody(),t=DOMGetter.getChatMousePosBody(),s=DOMGetter.getDeleteMessageOption();if(e&&MousePositionBodyPopupDOM.delete(),t&&ChatMousePosBodyPopupDOM.delete(),s&&DeleteMessageOptionPopupDOM.delete(),!GlobalVars.selectedMessagesID.length){let e="no message selected",t="",s=MyCodeErr.announce(e,t,!0);return void(s&&console.log(s))}let a=!1,n=null,o="notYou";o=GlobalVars.msgSenderTracking.indexOf(o),o<=-1&&(a=!0),n=GlobalVars.selectedMessagesID.length>1?"Delete "+GlobalVars.selectedMessagesID.length+" Messages?":"Delete Message?",DeleteMessageOptionPopupDOM.append(DeleteMessageOptionPopupDOM.create(n,a));let l={styles:[["background","black"],["opacity","0.5"]]};MousePositionBodyPopupDOM.append(MousePositionBodyPopupDOM.create(l)),ChatMousePosBodyPopupDOM.append(ChatMousePosBodyPopupDOM.create(l))}static fowardMessages(){if(GlobalVars.selectedMessagesID.length)console.log("fowardMessages"),alert("function not available yet");else{let e="no message selected",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static copyMessages(){if(GlobalVars.selectedMessagesID.length)console.log("copyMessages"),alert("function not available yet");else{let e="no message selected",t="",s=MyCodeErr.announce(e,t,!0);s&&console.log(s)}}static starMessages(){const e=ChatFuncs.getActiveChat();if(!GlobalVars.selectedMessagesID.length){let e="no message selected",t="",s=MyCodeErr.announce(e,t,!0);return void(s&&console.log(s))}const t=[...GlobalVars.selectedMessagesID];MsgGroupDeactivations.allSelected_Megchecked(),MsgApis.starMsg(e,t)}static getMessagesInfo(){if(!GlobalVars.selectedMessagesID.length){let e="no message selected",t="",s=MyCodeErr.announce(e,t,!0);return void(s&&console.log(s))}if(GlobalVars.selectedMessagesID.length>1){let e="please select only one message",t="",s=MyCodeErr.announce(e,t,!0);return void(s&&console.log(s))}let e=GlobalVars.selectedMessagesID[0];MsgOptions.getThisMessageInfo(e),MsgGroupDeactivations.allSelected_Megchecked()}static activateMessageHeadOthersS(){console.log("activateMessageHeadOthersS"),alert("function not available yet")}}class MsgGroupDeactivations{static megSelectMoreOptions(){const e=DOMGetter.getMousePositionBody(),t=DOMGetter.getChatMousePosBody();e&&MousePositionBodyPopupDOM.delete(),t&&ChatMousePosBodyPopupDOM.delete(),ShowChatBoxDOM.tryUnhide();let s=document.getElementsByClassName("megMoreOptionsBackground")[0],a=s.previousElementSibling;a.getElementsByClassName("subMsgMore")[0].classList.remove("optionUp"),MsgMoreOptionsDOM.delete(s,!0),a.style.display="",a.addEventListener("click",MsgGroupActivations.megSelectMoreOptions)}static removeAllSelectedHoverEffect(){let e=document.getElementsByClassName("selected");for(let t=0;t<e.length;t++)e[t].classList.remove("hover")}static resetAllSelectedHoverEffect(){let e=document.getElementsByClassName("selected");for(let t=0;t<e.length;t++)e[t].classList.add("hover")}static allSelected_Megchecked(){let e=DOMGetter.getMessageHeadNormal(),t=DOMGetter.getMessageHeadSelected(),s=DOMGetter.getMessageHeadBack(),a=DOMGetter.getMessageHeadCount();ShowChatBoxDOM.tryUnhide(),MessageFuncs.setIsSelectingMsgs(!1);let n=document.getElementsByClassName("selected"),o=document.getElementsByClassName("Megchecked");for(let e=0;e<n.length;e++)n[e].removeEventListener("click",MsgBody.selectUnselectMessage),n[e].removeEventListener("touchstart",MsgBody.selectUnselectMessage),n[e].classList.remove("s"),n[e].style.display="";for(let e=0;e<o.length;e++)o[e].getElementsByTagName("input")[0].removeAttribute("checked"),o[e].style.display="";MsgBody.emptySelectedMessagesID(),MessageHeadSelectedDOM.clearIcons(),a.innerHTML=GlobalVars.selectedMessagesID.length,e.style.display="",t.style.display="",s.removeEventListener("click",MsgGroupDeactivations.allSelected_Megchecked),MsgGroupDeactivations.resetAllSelectedHoverEffect()}}class ChatBoxDOM{static create(){const e=ChatFuncs.getActiveChat();let t=null,s=null,a=null;ChatBoxDB.chatHasChatBox(e)&&(t=ChatBoxDB.getChatBoxAttr(e),s=t.msg,a=t.rMsg);let n=document.createElement("div");n.id="chatBox",n.style.display="flex";let o=document.createElement("div");o.id="closeChatBox",o.className="material-icons flexCenter",o.innerHTML="close",n.appendChild(o);let l=document.createElement("div");l.className="cchatBox";let r=document.createElement("div");if(r.className="textMegContain",a){let e=ChatboxReplyDOM.create(a);r.appendChild(e),r.classList.add("replying")}let i=document.createElement("div");i.className="textContain";let c=document.createElement("div");c.className="text placeholder",c.innerHTML="Type text message",i.appendChild(c);let d=document.createElement("div");d.id="chatBoxTextMsg",d.className="text",d.setAttribute("contentEditable","true"),s&&(d.innerHTML=s,c.classList.add("hide")),i.appendChild(d),r.appendChild(i),l.appendChild(r),n.appendChild(l);let g=document.createElement("div");g.className="material-icons flexCenter send",g.innerHTML="send",n.appendChild(g);let h={closeChatBox:o,chatBoxTextMsg:d,sendIcon:g};return ChatBoxDOM.onload(h),n}static append(e){const t=DOMGetter.getMessage();if(t)t.appendChild(e);else{let e="msgElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static delete(){const e=DOMGetter.getChatBox();if(e)e.parentNode.removeChild(e);else{let e="chatBoxElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static onload(e){let t=e.closeChatBox,s=e.chatBoxTextMsg,a=e.sendIcon;t&&t.addEventListener("click",ChatBoxDOM.onclickCloseChatBoxButton),s&&(s.addEventListener("keyup",ChatBoxDOM.typingMessage),s.addEventListener("keydown",ChatBoxDOM.typingMessage)),a&&a.addEventListener("click",MsgBody.sendMsg)}static typingMessage(e){let t=e.target,s=t.previousElementSibling;if(t.innerHTML?s.classList.add("hide"):s.classList.remove("hide"),"keyup"==e.type){const e=t.innerHTML,s=ChatFuncs.getActiveChat();ChatBoxDB.updateMsg(s,e)}}static onclickCloseChatBoxButton(){DOMGetter.getShowChatBox()&&ShowChatBoxDOM.delete(),ChatBoxDOM.delete();const e=ChatFuncs.getActiveChat();ChatBoxDB.chatHasChatBox(e)&&ChatBoxDB.deleteChatBoxAttr(e),ShowChatBoxDOM.append(ShowChatBoxDOM.create())}}class ChatboxReplyDOM{static create(e){if(!e){const t=ChatFuncs.getActiveChat();e=ChatBoxDB.getRMsgObj(t)}if(!e){let e="rMsgObj not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);return void(a&&console.log(a))}let t,s,a,n,o,l;s="#"+MsgBody.makeMsgIDUsable(e.msgID),a=e.isSender,t=a?"you":"notYou",o=e.senderName,n=e.msg;let r=document.createElement("div");r.className="replyedMeg";let i=document.createElement("div");r.appendChild(i);let c=document.createElement("span");c.className="material-icons flexCenter close",c.innerHTML="close",r.appendChild(c),l=document.createElement("span"),l.className=t,r.appendChild(l);let d=document.createElement("a");d.href=s,l=document.createElement("span"),l.className=t,l.innerHTML=o,d.appendChild(l);let g=document.createTextNode(n);d.appendChild(g),r.appendChild(d);let h={close:c};return OnloadActivations.chatboxReplyElem(h),r}static append(e){let t=DOMGetter.getChatBox().getElementsByClassName("textMegContain")[0],s=t.getElementsByClassName("textContain")[0],a=s.parentNode;if(s)a.insertBefore(e,s),t.classList.add("replying");else{let e="textContainElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static delete(){let e=DOMGetter.getChatBox().getElementsByClassName("textMegContain")[0],t=e.getElementsByClassName("replyedMeg")[0];if(t)t.parentNode.removeChild(t),e.classList.remove("replying");else{let e="rMsgElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static close(){ChatboxReplyDOM.delete();const e=ChatFuncs.getActiveChat();ChatBoxDB.deleteRMsgObj(e)}}class MsgOptions{static selectThisMessage(e){let t=DOMGetter.getMessageHeadCount();const s=ChatFuncs.getActiveChat();let a=e.target.parentElement.dataset.id;e.target.removeEventListener("click",MsgOptions.selectThisMessage),MsgBody.emptySelectedMessagesID(),MsgGroupActivations.allSelected_Megchecked(),MsgGroupDeactivations.megSelectMoreOptions();let n=MessageFuncs.getMsgSenderClass(s,a),o=document.getElementsByName(a)[0],l=document.getElementsByName(a)[1].getElementsByTagName("input")[0];MsgBody.updateSelectedMessagesID(a,n),t.innerHTML=GlobalVars.selectedMessagesID.length,o.classList.add("s"),l.setAttribute("checked","true")}static getThisMessageInfo(e){let t=DOMGetter.getMsgInfoPopUp(),s=e.target,a=!0;s?s=e.target.parentElement.dataset.id:(s=e,a=!1),a&&MsgGroupDeactivations.megSelectMoreOptions(),s=MsgBody.makeMsgIDUsable(s);let n=ChatFuncs.getActiveChat(),o=MessageFuncs.getMessageObj(n,s),l=document.getElementById(s);l=l.cloneNode(!0);let r=o.drtime;t&&MsgInfoPopUpDOM.delete(),MsgInfoPopUpDOM.append(MsgInfoPopUpDOM.create(l,r)),MessageFuncs.setMsgInfoInView(n,s),t=DOMGetter.getMsgInfoPopUp();let i=t.getElementsByClassName("body")[0],c=t.getElementsByClassName("head")[0],d=i.getBoundingClientRect().height,g=i.scrollHeight;if(g>d){let e=g-d;i.scrollTop=i.scrollTop+e,c.classList.add("bodyScrl")}}static replyThisMessage(e){const t=ChatFuncs.getActiveChat();let s=DOMGetter.getChatBox(),a=e.target,n=!0;a?a=e.target.parentElement.dataset.id:(a=e,n=!1);const o=MessageFuncs.getMessageObj(t,a);o.chatID||(o.chatID=t),ChatBoxDB.addRMsgObj(t,o);const l=ChatBoxDB.getRMsgObj(t);s?(s.getElementsByClassName("textMegContain")[0].getElementsByClassName("replyedMeg")[0]&&ChatboxReplyDOM.delete(),ChatboxReplyDOM.append(ChatboxReplyDOM.create(l))):(ChatBoxDOM.append(ChatBoxDOM.create()),s=DOMGetter.getChatBox()),ShowChatBoxDOM.delete(!0),n&&MsgGroupDeactivations.megSelectMoreOptions()}static fowardThisMessage(e){let t=e.target.parentElement.dataset.id;console.log(t),console.log("fowardThisMessage"),alert("function not available yet")}static starThisMessage(e){const t=ChatFuncs.getActiveChat(),s=[e.target.parentElement.dataset.id];MsgGroupDeactivations.megSelectMoreOptions(),MsgApis.starMsg(t,s)}static deleteThisMessage(e){let t=DOMGetter.getMousePositionBody(),s=DOMGetter.getChatMousePosBody(),a=DOMGetter.getDeleteMessageOption();t&&MousePositionBodyPopupDOM.delete(),s&&ChatMousePosBodyPopupDOM.delete(),a&&DeleteMessageOptionPopupDOM.delete();const n=ChatFuncs.getActiveChat();let o=e.target.parentElement.dataset.id,l=MessageFuncs.getMsgSenderClass(n,o);MsgBody.emptySelectedMessagesID(),MsgBody.updateSelectedMessagesID(o,l);let r=!1;"you"==l&&(r=!0),DeleteMessageOptionPopupDOM.append(DeleteMessageOptionPopupDOM.create("Delete Message?",r)),MsgGroupDeactivations.megSelectMoreOptions();let i={styles:[["background","black"],["opacity","0.5"]]};MousePositionBodyPopupDOM.append(MousePositionBodyPopupDOM.create(i)),ChatMousePosBodyPopupDOM.append(ChatMousePosBodyPopupDOM.create(i))}static deleteMessage(e,t=!1){const s=ChatFuncs.getActiveChat();let a=[...GlobalVars.selectedMessagesID];t&&MsgGroupDeactivations.allSelected_Megchecked(),MsgApis.deleteMsg(s,a,e)}static activateDeleteMessage(e){let t,s=DOMGetter.getMessageHeadSelected(),a=e.target.classList.contains("DFE"),n=!1;GlobalVars.msgSenderTracking.indexOf("notYou")<0&&(n=!0),t=n&&a,MsgOptions.cancleDeleteMessage(),"flex"!=s.style.display?MsgOptions.deleteMessage(t):MsgOptions.deleteMessage(t,!0)}static cancleDeleteMessage(e){let t=DOMGetter.getChatMousePosBody(),s=DOMGetter.getMousePositionBody(),a=DOMGetter.getDeleteMessageOption(),n=!0;if(e){n=!1;let t=e.target.id;t&&"deleteMessageOption"==t&&(n=!0);let s=e.target.classList;s&&s.contains("C")&&(n=!0)}n&&(t&&ChatMousePosBodyPopupDOM.delete(),s&&MousePositionBodyPopupDOM.delete(),a&&DeleteMessageOptionPopupDOM.delete())}}class ChatOptions{static selectThisChat(e){const t=DOMGetter.getChatHeadCount();let s=e.target.parentElement.dataset.id,a=e.target,n=document.getElementById(s),o=n.getElementsByClassName("chatSelect")[0],l=e.target.parentElement.previousElementSibling;if(o&&ChatSelectedIconDOM.delete(s),a.removeEventListener("click",ChatOptions.selectThisChat),ChatGroupActivations.allChatSelected(),ChatGroupDeactivations.chatExpandMoreOptions(),n.style.background="#F5F5F5",ChatSelectedIconDOM.append(s,ChatSelectedIconDOM.create()),l.style.display="none",ChatBody.emptySelectedChatsID(),ChatBody.updateSelectedChatsID(s))t.innerHTML=GlobalVars.selectedChatsID.length;else{let e="Fatal error",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static deleteThisChat(e){if(!Settings.ChatOptions.deleteChat){let e="action not allowed",t="",s=MyCodeErr.announce(e,t,!0);return void(s&&console.log(s))}let t=DOMGetter.getMousePositionBody(),s=DOMGetter.getChatMousePosBody(),a=DOMGetter.getDeleteChatOption();t&&MousePositionBodyPopupDOM.delete(),s&&ChatMousePosBodyPopupDOM.delete(),a&&DeleteChatOptionPopupDOM.delete(),ChatGroupDeactivations.chatExpandMoreOptions();let n=e.target.parentElement.dataset.id;ChatBody.emptySelectedChatsID(),ChatBody.updateSelectedChatsID(n),DeleteChatOptionPopupDOM.append(DeleteChatOptionPopupDOM.create("Delete this Chat?"));let o={styles:[["background","black"],["opacity","0.5"]]};MousePositionBodyPopupDOM.append(MousePositionBodyPopupDOM.create(o)),ChatMousePosBodyPopupDOM.append(ChatMousePosBodyPopupDOM.create(o))}static pinThisChat(e){if(!Settings.ChatOptions.pinChat){let e="action not allowed",t="",s=MyCodeErr.announce(e,t,!0);return void(s&&console.log(s))}ChatGroupDeactivations.chatExpandMoreOptions();let t=[e.target.parentElement.dataset.id];ChatApis.pinChat(t)}static deleteChat(e=!1){let t=[...GlobalVars.selectedChatsID];e&&ChatGroupDeactivations.allChatSelected(),ChatApis.deleteChat(t)}static onclickDeleteChat(){let e=DOMGetter.getChatHeadSelected();ChatOptions.cancleChatDelete(),"flex"!=e.style.display?ChatOptions.deleteChat():ChatOptions.deleteChat(!0)}static cancleChatDelete(e){let t=DOMGetter.getChatMousePosBody(),s=DOMGetter.getMousePositionBody(),a=DOMGetter.getDeleteChatOption(),n=!0;if(e){n=!1;let t=e.target.id;t&&"deleteChatOption"==t&&(n=!0);let s=e.target.classList;s&&s.contains("C")&&(n=!0)}n&&(t&&ChatMousePosBodyPopupDOM.delete(),s&&MousePositionBodyPopupDOM.delete(),a&&DeleteChatOptionPopupDOM.delete())}}class MousePositionBodyPopupDOM{static create(e=null){let t,s;e&&(t=e.styles,s=e.functs);let a=document.createElement("div");return a.id="mousePositionBody",t&&t.forEach((e=>{a.style[e[0]]=e[1]})),s&&s.forEach((e=>{a.addEventListener(e[0],e[1])})),a}static append(e){const t=DOMGetter.getPageSection();if(t){let s=t.children[0];t.insertBefore(e,s)}else{let e="pageSection not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(){const e=DOMGetter.getMousePositionBody();if(e)e.parentNode.removeChild(e);else{let e="mousePositionBody not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}}class ShowProfilePicturePopupDOM{static create(e){let t=document.createElement("div");t.id="showProfilePicture";let s=document.createElement("div");s.className="material-icons flexCenter close",s.innerHTML="close",t.appendChild(s);let a=document.createElement("img");a.src=e,a.alt="pix",t.appendChild(a),t.style.display="flex";let n={close:s};return ShowProfilePicturePopupDOM.onload(n),t}static append(e){const t=DOMGetter.getPageSection();if(t)t.appendChild(e);else{let e="pageSection not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(){const e=DOMGetter.getShowProfilePicture();if(e)e.parentNode.removeChild(e);else{let e="showProfilePicture not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static onload(e){const t=e.close;t&&t.addEventListener("click",ProfileFunc.closeProfilePictureView)}}class DeleteMessageOptionPopupDOM{static create(e,t=!1){let s,a=document.createElement("div");a.id="deleteMessageOption";let n=document.createElement("span");s=document.createElement("div");let o=document.createElement("span");o.className="D",o.innerHTML=e,s.appendChild(o),n.appendChild(s),s=document.createElement("div");let l=document.createElement("span");l.className="action DFM",l.innerHTML="DELETE FOR ME",s.appendChild(l),n.appendChild(s);let r=null;t&&(s=document.createElement("div"),r=document.createElement("span"),r.className="action DFE",r.innerHTML="DELETE FOR EVERYONE",s.appendChild(r),n.appendChild(s)),s=document.createElement("div");let i=document.createElement("span");i.className="action C",i.innerHTML="CANCLE",s.appendChild(i),n.appendChild(s),a.appendChild(n);let c={DFM:l,DFE:r,cancle:i,deleteMessageOption:a};return DeleteMessageOptionPopupDOM.onload(c),a}static append(e){const t=DOMGetter.getPageSection();if(t)t.appendChild(e);else{let e="pageSection not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(){const e=DOMGetter.getDeleteMessageOption();if(e)e.parentNode.removeChild(e);else{let e="deleteMessageOption not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static onload(e){const t=e.DFM,s=e.DFE,a=e.cancle,n=e.deleteMessageOption;t&&t.addEventListener("click",MsgOptions.activateDeleteMessage),s&&s.addEventListener("click",MsgOptions.activateDeleteMessage),a&&a.addEventListener("click",MsgOptions.cancleDeleteMessage),n&&n.addEventListener("click",MsgOptions.cancleDeleteMessage)}}class MsgInfoPopUpDOM{static create(e,t){let s=t[0],a=t[1];a||(a="-"),s||(s="-");let n=document.createElement("div");n.id="msgInfoPopUp";let o=document.createElement("div");o.className="head";let l=document.createElement("span");l.className="material-icons flexCenter back",l.innerHTML="arrow_back",o.appendChild(l);let r=document.createElement("span");r.className="title",r.innerHTML="Message info",o.appendChild(r),n.appendChild(o);let i=document.createElement("div");i.className="body";let c,d,g=document.createElement("div");g.className="MIPMsg",g.appendChild(e),i.appendChild(g);let h=document.createElement("div");h.className="MIPSta";let M=document.createElement("div");M.className="MIPRead",r=document.createElement("div"),r.className="title",c=document.createElement("span"),c.className="material-icons flexCenter read",c.innerHTML="done_all",r.appendChild(c),c=document.createElement("span"),c.innerHTML="Read",r.appendChild(c),M.appendChild(r),d=document.createElement("div"),d.className="time",d.innerHTML=a,M.appendChild(d),h.appendChild(M);let m=document.createElement("hr");h.appendChild(m);let u=document.createElement("div");u.className="MIPDeliver",r=document.createElement("div"),r.className="title",c=document.createElement("span"),c.className="material-icons flexCenter read",c.innerHTML="done_all",r.appendChild(c),c=document.createElement("span"),c.innerHTML="Read",r.appendChild(c),u.appendChild(r),d=document.createElement("div"),d.className="time",d.innerHTML=s,u.appendChild(d),h.appendChild(u),i.appendChild(h),n.appendChild(i);let C={body:i,back:l};return MsgInfoPopUpDOM.onload(C),n}static append(e){const t=DOMGetter.getPageSection();if(t)t.appendChild(e);else{let e="pageSection not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(){const e=DOMGetter.getMsgInfoPopUp();if(e)e.parentNode.removeChild(e);else{let e="msgInfoPopUp not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static onload(e){const t=e.body,s=e.back;t&&t.addEventListener("scroll",MsgInfoPopUpDOM.scrlFunc),s&&s.addEventListener("click",MsgInfoPopUpDOM.delete)}static scrlFunc(){let e=DOMGetter.getMsgInfoPopUp(),t=e.getElementsByClassName("body")[0],s=e.getElementsByClassName("head")[0];t.scrollTop?s.classList.add("bodyScrl"):s.classList.remove("bodyScrl")}}class ChatMousePosBodyPopupDOM{static create(e=null){let t,s;e&&(t=e.styles,s=e.functs);let a=document.createElement("div");return a.id="chatMousePosBody",t&&t.forEach((e=>{a.style[e[0]]=e[1]})),s&&s.forEach((e=>{a.addEventListener(e[0],e[1])})),a}static append(e){const t=DOMGetter.getChat();if(t){let s=t.children[0];t.insertBefore(e,s)}else{let e="chatDom not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(){const e=DOMGetter.getChatMousePosBody();if(e)e.parentNode.removeChild(e);else{let e="chatMousePosBody not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}}class DeleteChatOptionPopupDOM{static create(e){let t,s=document.createElement("div");s.id="deleteChatOption";let a=document.createElement("span");t=document.createElement("div");let n=document.createElement("span");n.className="D",n.innerHTML=e,t.appendChild(n),a.appendChild(t),t=document.createElement("div");let o=document.createElement("span");o.className="action Del",o.innerHTML="DELETE",t.appendChild(o),a.appendChild(t),t=document.createElement("div");let l=document.createElement("span");l.className="action C",l.innerHTML="CANCLE",t.appendChild(l),a.appendChild(t),s.appendChild(a);let r={Del:o,cancle:l,deleteChatOption:s};return DeleteChatOptionPopupDOM.onload(r),s}static append(e){const t=DOMGetter.getPageSection();if(t)t.appendChild(e);else{let e="pageSection not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(){const e=DOMGetter.getDeleteChatOption();if(e)e.parentNode.removeChild(e);else{let e="deleteChatOption not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static onload(e){const t=e.Del,s=e.cancle,a=e.deleteChatOption;t&&t.addEventListener("click",ChatOptions.onclickDeleteChat),s&&s.addEventListener("click",ChatOptions.cancleChatDelete),a&&a.addEventListener("click",ChatOptions.cancleChatDelete)}}class ChatHeadSelecOpts{static pinChats(){if(!Settings.ChatOptions.groupChatPin){let e="action not allowed",t="",s=MyCodeErr.announce(e,t,!0);return void(s&&console.log(s))}if(!GlobalVars.selectedChatsID.length){let e="no chat selected";return alert(e),void console.log(e)}let e=[...GlobalVars.selectedChatsID];ChatGroupDeactivations.allChatSelected(),ChatBody.emptySelectedChatsID(),ChatApis.pinChat(e)}static deleteChats(){if(!Settings.ChatOptions.groupDelChat){let e="action not allowed",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}let e=DOMGetter.getMousePositionBody(),t=DOMGetter.getChatMousePosBody(),s=DOMGetter.getDeleteChatOption();if(e&&MousePositionBodyPopupDOM.delete(),t&&ChatMousePosBodyPopupDOM.delete(),s&&DeleteChatOptionPopupDOM.delete(),!GlobalVars.selectedChatsID.length){let e="no chat selected",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}let a="Delete "+GlobalVars.selectedChatsID.length+" Chats?";DeleteChatOptionPopupDOM.append(DeleteChatOptionPopupDOM.create(a));let n={styles:[["background","black"],["opacity","0.5"]]};MousePositionBodyPopupDOM.append(MousePositionBodyPopupDOM.create(n)),ChatMousePosBodyPopupDOM.append(ChatMousePosBodyPopupDOM.create(n))}static activateChatHeadOthersS(){console.log("activateChatHeadOthersS"),alert("function not available yet")}}class ChatHeadDOM{static create(){let e=document.createElement("div");return e.id="chatHead",e}static append(e){const t=DOMGetter.getChat();if(t)t.appendChild(e);else{let e="chatDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(){const e=DOMGetter.getChatHead();if(e)e.parentNode.removeChild(e);else{let e="chatHeadDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}}class ChatHeadNormalDOM{static create(e){let t=document.createElement("div");t.id="chatHeadNormal";let s=document.createElement("div");s.id="chatChatMinimize",s.className="material-icons flexCenter",s.innerHTML="clear",t.appendChild(s);let a=document.createElement("div");a.id="chatHeadPix";let n=document.createElement("img");n.src=e,n.alt="pix",a.appendChild(n),t.appendChild(a);let o=document.createElement("div");o.id="chatSubContain";let l=document.createElement("div");l.id="chatHeadChat",l.className="material-icons flexCenter",l.innerHTML="chat",o.appendChild(l);let r=document.createElement("div");r.id="chatHeadSearchChat",r.className="material-icons flexCenter",r.innerHTML="search",o.appendChild(r);let i=document.createElement("div");i.id="chatHeadOthers",i.className="material-icons flexCenter",i.innerHTML="more_vert",o.appendChild(i);let c=document.createElement("div");c.id="chatHeadOthersOptions",c.className="hide";let d=document.createElement("p");d.className="chatHeadOptionSelect",d.innerHTML="Select",c.appendChild(d),o.appendChild(c);let g={chatChatMinimize:s,chatHeadChat:l,chatHeadSearchChat:r,chatHeadOthers:i,chatHeadPix:a};return OnloadActivations.chatHeadNormalElem(g),t.appendChild(o),t}static append(e){const t=DOMGetter.getChatHead();if(t)t.appendChild(e);else{let e="chatHeadDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(){const e=DOMGetter.getChatHeadNormal();if(e)e.parentNode.removeChild(e);else{let e="chatHeadNormaldDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static onclickChatMinimizeBotton(){const e=DOMGetter.getChat(),t=DOMGetter.getMessage(),s=DOMGetter.getMessageChatMaximize(),a=DOMGetter.getMsgSelectAChat();t.style.width="100%",e.style.display="none",s&&(s.style.display="flex"),a&&(a.getElementsByClassName("selectAChatBtn")[0].style.display="flex")}}class ChatHeadSelectedDOM{static create(){let e=document.createElement("div");e.id="chatHeadSelected";let t=document.createElement("div");t.id="chatHeadBack",t.className="material-icons flexCenter",t.innerHTML="arrow_back",e.appendChild(t);let s=document.createElement("div");return s.id="chatHeadCount",s.className="flexCenter",s.innerHTML="0",e.appendChild(s),e}static append(e){const t=DOMGetter.getChatHead();if(t)t.appendChild(e);else{let e="chatHeadDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(){const e=DOMGetter.getChatHeadSelected();if(e)e.parentNode.removeChild(e);else{let e="chatHeadSelectedDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static loadIcons(e=null){const t=Settings.ChatOptions;if(e||(e=DOMGetter.getChatHeadSelected()),t.pinChat){let t=ChatHeadSelectedDOM.createChatPinIcon();e.appendChild(t)}if(t.deleteChat){let t=ChatHeadSelectedDOM.createChatDelIcon();e.appendChild(t)}let s=document.createElement("div");return s.id="chatHeadOthersS",s.className="material-icons flexCenter",s.innerHTML="more_vert",s.addEventListener("click",ChatHeadSelecOpts.activateChatHeadOthersS),e.appendChild(s),e}static clearIcons(){let e=DOMGetter.getChatHeadPin(),t=DOMGetter.getChatHeadDelete(),s=DOMGetter.getChatHeadOthersS();e&&ChatHeadSelectedDOM.deleteIcon(e),t&&ChatHeadSelectedDOM.deleteIcon(t),s&&ChatHeadSelectedDOM.deleteIcon(s)}static createChatPinIcon(){let e=document.createElement("div");return e.id="chatHeadPin",e.className="flexCenter",e.innerHTML='<svg viewBox="0 0 19 19" width="19" height="19"><path fill="currentColor" d="M9.5 18.419C4.574 18.419.581 14.426.581 9.5S4.574.581 9.5.581s8.919 3.993 8.919 8.919-3.993 8.919-8.919 8.919zm2.121-5.708l-.082-2.99 1.647-1.963a1.583 1.583 0 0 0-.188-2.232l-.32-.269a1.58 1.58 0 0 0-2.231.203L8.803 7.42l-2.964.439a.282.282 0 0 0-.14.496l5.458 4.58c.186.157.47.019.464-.224zM5.62 13.994a.504.504 0 0 0 .688-.038l2.204-2.307-1.085-.91-1.889 2.571a.504.504 0 0 0 .082.684z"></path></svg>',e.addEventListener("click",ChatHeadSelecOpts.pinChats),e}static createChatDelIcon(){let e=document.createElement("div");return e.id="chatHeadDelete",e.className="material-icons flexCenter",e.innerHTML="delete",e.addEventListener("click",ChatHeadSelecOpts.deleteChats),e}static appendIcon(e){const t=DOMGetter.getChatHeadSelected();if(!t){let e="chatHeadSelectedDOM not found",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}const s=DOMGetter.getChatHeadOthersS();s?t.insertBefore(e,s):t.appendChild(e)}static deleteIcon(e){if(!e){let e="iconElem not found",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}const t=e.parentElement;if(t)if("chatHeadSelected"==t.id)t.removeChild(e);else{let e="got the wrong element",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}else{let e="chatHeadSelectedDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}}class ChatGroupDeactivations{static chatExpandMoreOptions(){const e=DOMGetter.getMousePositionBody(),t=DOMGetter.getChatMousePosBody();e&&MousePositionBodyPopupDOM.delete(),t&&ChatMousePosBodyPopupDOM.delete();let s=document.getElementsByClassName("chatMoreOptions")[0].previousElementSibling,a=s.dataset.id;ChatMoreOptionsDOM.delete(a),s.style.display=""}static removeAllChatHoverEffect(){let e=document.getElementsByClassName("chatContain");for(let t=0;t<e.length;t++)e[t].classList.remove("hover")}static resetAllChatHoverEffect(){let e=document.getElementsByClassName("chatContain");for(let t=0;t<e.length;t++)e[t].classList.add("hover")}static allChatSelected(){GlobalVars.chatsAreSelected=!1;const e=DOMGetter.getChatHeadBack(),t=DOMGetter.getChatHeadCount(),s=DOMGetter.getChatHeadNormal(),a=DOMGetter.getChatHeadSelected();ShowChatBoxDOM.tryUnhide(),ChatFuncs.setIsSelectingChats(!1);let n=document.getElementsByClassName("chatSelected"),o=document.getElementsByClassName("chatContain"),l=document.getElementsByClassName("chatExpandMore");for(let e=0;e<l.length;e++)l[e].style.display="";for(let e=0;e<o.length;e++){let t=o[e].getElementsByClassName("chatSelect")[0];o[e].style.background="";let s=o[e].id;t&&ChatSelectedIconDOM.delete(s)}for(let e=0;e<n.length;e++)n[e].removeEventListener("click",ChatBody.selectUnselectChat),n[e].removeEventListener("touchstart",ChatBody.selectUnselectChat),n[e].style.display="";ChatHeadSelectedDOM.clearIcons(),ChatBody.emptySelectedChatsID(),t.innerHTML=GlobalVars.selectedChatsID.length,s.style.display="",a.style.display="",e.removeEventListener("click",ChatGroupDeactivations.allChatSelected)}}class ChatBodyDOM{static create(){let e=document.createElement("div");return e.id="chatBody",e.className="chatBody",e}static append(e){const t=DOMGetter.getChat();if(t)t.appendChild(e);else{let e="chatDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(){const e=DOMGetter.getChatBody();if(e)e.parentNode.removeChild(e);else{let e="chatBodyDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static clear(){let e=DOMGetter.getChatBody().children;if(e){let t=e.length;for(let s=0;s<t;s++)e[0].parentNode.removeChild(e[0])}else{let e="allChatBodyContent undefined",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}}class ChatContainDOM{static create(e){let t=e.chatID,s=e.imgSrc,a=e.name,n=e.unreadMsgCount,o=e.pined,l=e.lastMsgObj,r=l.timeSentString;t=ChatBody.makeChatIDUsable(t);let i=document.createElement("div");e.isDeleting?i.className="chatContainNotActive hover":i.className="chatContain hover",i.id=t,i.dataset.id=t;let c=document.createElement("div");c.className="chatSelected",c.dataset.id=t,c.setAttribute("name",t),i.appendChild(c);let d=document.createElement("div");d.className="chatPix";let g=document.createElement("img");g.src=s,g.alt="pix",d.appendChild(g),i.appendChild(d);let h=document.createElement("div");h.className="chatSubContain";let M=document.createElement("div");M.className="nameContain";let m=document.createElement("div");m.className="nameSubContain",m.innerHTML=a,M.appendChild(m);let u=document.createElement("div");u.className="chatTimeContain",u.innerHTML=r,M.appendChild(u),h.appendChild(M);let C=ChatContainDOM.createLMegContainElem(t,n,o,l);return h.appendChild(C),i.appendChild(h),ChatGroupActivations.allChatsFunctions(i),ChatGroupActivations.allChatOntouchEvent(i),i}static append(e){const t=DOMGetter.getChatBody();if(t)t.appendChild(e);else{let e="chatBodyDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(e,t=!1){e=ChatBody.makeChatIDUsable(e);let s=document.getElementById(e);if(s)s.parentNode.removeChild(s);else if(!t){let e="error with chatContain",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static createLMegContainElem(e,t,s,a){const n=Settings.ChatOptions;e=ChatBody.makeChatIDUsable(e);let o="",l="",r=a.read,i=a.lastMsg,c=a.isSender;"read"==r&&(o="read"),l="sent"==r?"done":"done_all";let d=document.createElement("div");d.className="lMegContain";let g=document.createElement("div");if(g.className="lMegContain1",c){let e=LMegReadDOM.create(o,l);g.appendChild(e)}let h=document.createElement("div");h.className="lMeg",h.innerHTML=i,g.appendChild(h),d.appendChild(g);let M=document.createElement("div");if(M.className="lMegContain2",n.pinChat&&s){let e=ChatPinedDOM.create();M.appendChild(e)}if(t){let e=ChatCountDOM.create(t);M.appendChild(e)}let m=document.createElement("div");return m.className="material-icons flexCenter chatExpandMore",m.innerHTML="expand_more",m.dataset.id=e,m.setAttribute("name",e),M.appendChild(m),d.appendChild(M),d}static getAllChatContains(){const e=DOMGetter.getChatBody();return e?e.getElementsByClassName("chatContain"):[]}static getCountChatContains(){return ChatContainDOM.getAllChatContains().length}static makeSelectable(e){e=ChatBody.makeChatIDUsable(e);let t=document.getElementById(e);if(t)t.classList.remove("chatContainNotActive"),t.classList.add("chatContain");else{let e="error with chatContain",t="",s=MyCodeErr.announce(e,t,!1,!0);s&&console.log(s)}}static makeUnselectable(e){e=ChatBody.makeChatIDUsable(e);let t=document.getElementById(e);if(t)t.classList.remove("chatContain"),t.classList.add("chatContainNotActive");else{let e="error with chatContain",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static isSelectable(e){return!!e.classList.contains("chatContain")}}class ChatPinedDOM{static create(){if(!Settings.ChatOptions.pinChat){let e="pin chat action is not allowed",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}let e=document.createElement("div");return e.className="material-icons flexCenter chatPined",e.innerHTML='<svg viewBox="0 0 19 19" width="19" height="19"><path fill="currentColor" d="M9.5 18.419C4.574 18.419.581 14.426.581 9.5S4.574.581 9.5.581s8.919 3.993 8.919 8.919-3.993 8.919-8.919 8.919zm2.121-5.708l-.082-2.99 1.647-1.963a1.583 1.583 0 0 0-.188-2.232l-.32-.269a1.58 1.58 0 0 0-2.231.203L8.803 7.42l-2.964.439a.282.282 0 0 0-.14.496l5.458 4.58c.186.157.47.019.464-.224zM5.62 13.994a.504.504 0 0 0 .688-.038l2.204-2.307-1.085-.91-1.889 2.571a.504.504 0 0 0 .082.684z"></path></svg>',e}static append(e,t){if(!Settings.ChatOptions.pinChat){let e="pin chat action is not allowed",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}e=ChatBody.makeChatIDUsable(e);let s=document.getElementById(e);if(s){let e=s.getElementsByClassName("lMegContain2")[0],a=e.children[0];if(e)e.insertBefore(t,a);else{let e="lMegContain2DOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}else{let e="chatContainDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(e){e=ChatBody.makeChatIDUsable(e);let t=document.getElementById(e);if(t){let e=t.getElementsByClassName("lMegContain2")[0],s=e.getElementsByClassName("chatPined")[0];if(e&&s)e.removeChild(s);else{let e="lMegContain2DOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}else{let e="chatContainDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}}class ChatCountDOM{static create(e=0){let t=document.createElement("div");return t.className="flexCenter chatCount",t.innerHTML=e,t}static append(e,t){e=ChatBody.makeChatIDUsable(e);let s=document.getElementById(e);if(s){let e=s.getElementsByClassName("lMegContain2")[0],a=e.getElementsByClassName("chatExpandMore")[0];if(e)e.insertBefore(t,a);else{let e="lMegContain2DOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}else{let e="chatContainDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(e){e=ChatBody.makeChatIDUsable(e);let t=document.getElementById(e);if(t){let e=t.getElementsByClassName("lMegContain2")[0],s=e.getElementsByClassName("chatCount")[0];if(e&&s)e.removeChild(s);else{let e="lMegContain2DOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}else{let e="chatContainDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}}class LoadOlderChatsDOM{static create(){let e=document.createElement("div");return e.id="getOlderChat",e.innerHTML="Older Chats",e.addEventListener("click",LoadOlderChatsDOM.onClick),e}static append(e){const t=DOMGetter.getChatBody();if(t)t.appendChild(e);else{let e="chatBodyDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(){const e=DOMGetter.getGetOlderChat();if(e)e.parentElement.removeChild(e);else{let e="getOlderDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static async onClick(){await ChatFuncs.fetchOlderChats(),LoadOlderChatsDOM.delete(),ChatFuncs.pushInFetchedChat(!0)}}class ChatSelectedIconDOM{static create(){let e=document.createElement("span");return e.className="material-icons flexCenter chatSelect",e.innerHTML="done",e.style.display="block",e}static append(e,t){e=ChatBody.makeChatIDUsable(e);let s=document.getElementById(e);if(s){let e=s.getElementsByClassName("chatPix")[0];if(e)e.appendChild(t);else{let e="chatPixDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}else{let e="chatContainDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(e){e=ChatBody.makeChatIDUsable(e);let t=document.getElementById(e);if(t){let e=t.getElementsByClassName("chatPix")[0],s=e.getElementsByClassName("chatSelect")[0];if(e&&s)s.parentElement.removeChild(s);else{let e="chatPixDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}else{let e="chatContainDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}}class ChatOnlineIconDOM{static create(){let e=document.createElement("span");return e.className="flexCenter online",e.style.display="block",e}static append(e,t){e=ChatBody.makeChatIDUsable(e);let s=document.getElementById(e);if(s){let e=s.getElementsByClassName("chatPix")[0];if(e)e.appendChild(t);else{let e="chatPixDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}else{let e="chatContainDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(e){e=ChatBody.makeChatIDUsable(e);let t=document.getElementById(e);if(t){let e=t.getElementsByClassName("chatPix")[0];if(!e)return void console.log("fatal error 001");let s=e.getElementsByClassName("online")[0];if(s)s.parentElement.removeChild(s);else{let e="onlineIconElem not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}else{let e="chatContainDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}}class LMegReadDOM{static create(e,t){let s=document.createElement("div");return s.className="material-icons flexCenter lMegRead",e&&(s.className="material-icons flexCenter lMegRead "+e),s.innerHTML=t,s}static append(e,t){e=ChatBody.makeChatIDUsable(e);let s=document.getElementById(e);if(s){let e=s.getElementsByClassName("lMegContain1")[0];if(e){let s=e.firstChild;e.insertBefore(t,s)}else{let e="lMegContain1 not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}else{let e="chatContainDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(e){e=ChatBody.makeChatIDUsable(e);let t=document.getElementById(e);if(t){let e=t.getElementsByClassName("lMegContain1")[0],s=e.getElementsByClassName("lMegRead")[0];if(e&&s)s.parentElement.removeChild(s);else{let e="lMegContain1DOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}else{let e="chatContainDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}}class ChatMoreOptionsDOM{static create(e){const t=Settings.ChatOptions;let s=document.createElement("div");s.className="chatMoreOptions",s.dataset.id=e,s.setAttribute("name",e);let a="Pin";document.getElementById(e).getElementsByClassName("lMegContain2")[0].getElementsByClassName("chatPined")[0]&&(a="Unpin");let n=[];return t.selectChat&&n.push(["selectThisChat","Select"]),t.deleteChat&&n.push(["deleteThisChat","Delete"]),t.pinChat&&n.push(["pinThisChat",a]),n.forEach((e=>{let t=document.createElement("p");t.className=e[0],t.innerHTML=e[1],s.appendChild(t)})),ChatMoreOptionsDOM.onload(s,e),s}static append(e,t){e=ChatBody.makeChatIDUsable(e);let s=document.getElementById(e);if(s){let e=s.getElementsByClassName("lMegContain2")[0];if(e)e.appendChild(t);else{let e="lMegContain2DOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}else{let e="chatContainDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(e){e=ChatBody.makeChatIDUsable(e);let t=document.getElementById(e);if(t){let e=t.getElementsByClassName("lMegContain2")[0],s=e.getElementsByClassName("chatMoreOptions")[0];if(e&&s)s.parentElement.removeChild(s);else{let e="lMegContain2DOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}else{let e="chatContainDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static onload(e,t){let s=e.getElementsByClassName("selectThisChat")[0],a=e.getElementsByClassName("deleteThisChat")[0],n=e.getElementsByClassName("pinThisChat")[0];s&&s.addEventListener("click",ChatOptions.selectThisChat),a&&(ChatFuncs.chatIsDeleting(t)?ChatMoreOptionsDOM.makeOptionUclickale(0,0,a):a.addEventListener("click",ChatOptions.deleteThisChat)),n&&(ChatFuncs.chatIsPinning(t)?ChatMoreOptionsDOM.makeOptionUclickale(0,0,n):n.addEventListener("click",ChatOptions.pinThisChat))}static makeOptionUclickale(e,t,s){if(!s){const a={sel:"selectThisChat",del:"deleteThisChat",pin:"pinThisChat"};e=ChatBody.makeChatIDUsable(e);let n=document.getElementById(e);if(!n){let e="chatContainDOM not found",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}let o=n.getElementsByClassName("lMegContain2")[0].getElementsByClassName("chatMoreOptions")[0];if(!o)return;s=o.getElementsByClassName(a[t])[0]}s&&(s.classList.add("processing"),s.classList.contains("selectThisChat")&&s.removeEventListener("click",ChatOptions.selectThisChat),s.classList.contains("deleteThisChat")&&s.removeEventListener("click",ChatOptions.deleteThisChat),s.classList.contains("pinThisChat")&&s.removeEventListener("click",ChatOptions.pinThisChat))}static makeOptionClickale(e,t,s){if(!s){const a={sel:"selectThisChat",del:"deleteThisChat",pin:"pinThisChat"};e=ChatBody.makeChatIDUsable(e);let n=document.getElementById(e);if(!n){let e="chatContainDOM not found",t="",s=MyCodeErr.announce(e,t,!1,!0);return void(s&&console.log(s))}let o=n.getElementsByClassName("lMegContain2")[0].getElementsByClassName("chatMoreOptions")[0];if(!o)return;s=o.getElementsByClassName(a[t])[0]}s&&(s.classList.remove("processing"),s.classList.contains("selectThisChat")&&s.addEventListener("click",ChatOptions.selectThisChat),s.classList.contains("deleteThisChat")&&s.addEventListener("click",ChatOptions.deleteThisChat),s.classList.contains("pinThisChat")&&s.addEventListener("click",ChatOptions.pinThisChat))}}class NoChatFoundDOM{static create(){let e=document.createElement("div");return e.className="noChatFound",e.innerHTML="No chat found",e}static append(e){const t=DOMGetter.getChatBody();if(t)t.appendChild(e);else{let e="chatBodyDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(){ChatBodyDOM.clear()}}class ChatGroupActivations{static chatExpandMoreOptions(e){const t=DOMGetter.getMousePositionBody(),s=DOMGetter.getChatMousePosBody();t&&MousePositionBodyPopupDOM.delete(),s&&ChatMousePosBodyPopupDOM.delete();const a=DOMGetter.getChatBody();let n=e.target,o=n.dataset.id,l=document.getElementById(o);ChatMoreOptionsDOM.append(o,ChatMoreOptionsDOM.create(o));let r=n.nextElementSibling;r.className="chatMoreOptions",n.style.display="flex",r.style.top&&(r.style.top="0");let i=a.getBoundingClientRect(),c=l.getBoundingClientRect(),d=r.getBoundingClientRect(),g=n.getBoundingClientRect(),h=g.bottom-c.top+"px";r.style.top=h,d=r.getBoundingClientRect();let M=i.bottom;if(M<d.bottom){let e=null;if(g.top-i.top>=d.height){e=!0;let t=d.height-(c.bottom-g.top)+"px";t="-"+t,r.style.top=t}if(!e){let e=d.bottom-M+5;a.scrollTo(a.scrollLeft,a.scrollTop+e)}}let m={functs:[["click",ChatGroupDeactivations.chatExpandMoreOptions]]};MousePositionBodyPopupDOM.append(MousePositionBodyPopupDOM.create(m)),ChatMousePosBodyPopupDOM.append(ChatMousePosBodyPopupDOM.create(m))}static allChatOntouchEvent(e=null){if(e)e.addEventListener("touchstart",ChatBody.touchedThisChat);else{let e=document.getElementsByClassName("chatContain");for(let t=0;t<e.length;t++)e[t].addEventListener("touchstart",ChatBody.touchedThisChat)}}static allChatsFunctions(e=null){if(e){let t=e.getElementsByClassName("chatExpandMore")[0],s=e.getElementsByTagName("img")[0];e.addEventListener("click",ChatBody.loadChatMessages),t.addEventListener("click",ChatGroupActivations.chatExpandMoreOptions),s.addEventListener("click",ProfileFunc.viewChatProfilePicture),s.addEventListener("touchstart",ProfileFunc.viewChatProfilePicture)}else{let e=document.getElementsByClassName("chatContain");for(let t=0;t<e.length;t++){e[t].addEventListener("click",ChatBody.loadChatMessages);let s=e[t].getElementsByClassName("chatExpandMore")[0],a=e[t].getElementsByTagName("img")[0];s&&s.addEventListener("click",ChatGroupActivations.chatExpandMoreOptions),a&&(a.addEventListener("click",ProfileFunc.viewChatProfilePicture),a.addEventListener("touchstart",ProfileFunc.viewChatProfilePicture))}}}static allChatSelected(e=null){if(e&&e.id){let t=e.getElementsByClassName("chatSelected")[0],s=e.getElementsByClassName("chatExpandMore")[0];s&&(s.style.display="none"),t&&(t.style.display="block",t.addEventListener("click",ChatBody.selectUnselectChat),t.addEventListener("touchstart",ChatBody.selectUnselectChat))}else{GlobalVars.chatsAreSelected=!0;const e=DOMGetter.getChatHeadBack(),t=DOMGetter.getChatHeadNormal(),s=DOMGetter.getChatHeadSelected();DOMGetter.getMessageHeadNormal()&&MsgGroupDeactivations.allSelected_Megchecked(),ChatBody.emptySelectedChatsID(),ChatFuncs.setIsSelectingChats(!0),setTimeout((()=>{ShowChatBoxDOM.tryHide()}),50);let a=document.getElementsByClassName("chatSelected"),n=document.getElementsByClassName("chatExpandMore");for(let e=0;e<n.length;e++)n[e].style.display="none";for(let e=0;e<a.length;e++)a[e].style.display="block",a[e].addEventListener("click",ChatBody.selectUnselectChat),a[e].addEventListener("touchstart",ChatBody.selectUnselectChat);ChatHeadSelectedDOM.loadIcons(),t.style.display="none",s.style.display="flex",e.addEventListener("click",ChatGroupDeactivations.allChatSelected)}}}class ChatSearchDOM{static create(){let e=document.createElement("div");e.id="chatSearch";let t=document.createElement("div"),s=document.createElement("span");s.id="chatSearchBack",s.className="material-icons flexCenter",s.innerHTML="search",t.appendChild(s);let a=document.createElement("div"),n=document.createElement("div");n.className="chatSearchInput placeholder",n.innerHTML="Serach for chats",a.appendChild(n);let o=document.createElement("div");o.className="chatSearchInput",o.setAttribute("contentEditable","true"),a.appendChild(o),t.appendChild(a);let l=document.createElement("span");l.id="chatSearchClear",l.className="material-icons flexCenter hide",l.innerHTML="close",t.appendChild(l),e.appendChild(t);let r=document.createElement("span");r.className="material-icons flexCenter chatSearchClose",r.innerHTML="close",e.appendChild(r);let i={chatSearch:e,chatSearchClose:r};return OnloadActivations.chatSearchElem(i),e}static append(e){const t=DOMGetter.getChat(),s=DOMGetter.getChatBody();if(t&&s)t.insertBefore(e,s);else{let e="counl not get required elements",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static delete(){const e=DOMGetter.getChatSearch();if(e)e.parentNode.removeChild(e);else{let e="counl not get chatSearchElem",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}}class ChatHead{static deactivateChatHeadOthersOption(){const e=DOMGetter.getMousePositionBody(),t=DOMGetter.getChatMousePosBody();e&&MousePositionBodyPopupDOM.delete(),t&&ChatMousePosBodyPopupDOM.delete(),ShowChatBoxDOM.tryUnhide();const s=DOMGetter.getChatHeadOthers(),a=DOMGetter.getChatHeadOthersOptions();let n=a.getElementsByClassName("chatHeadOptionSelect")[0];n.removeEventListener("click",ChatGroupActivations.allChatSelected),n.removeEventListener("click",ChatHead.deactivateChatHeadOthersOption),a.className="hide",s.style.background=""}static activateChatHeadOthersOption(){const e=DOMGetter.getMousePositionBody(),t=DOMGetter.getChatMousePosBody();e&&MousePositionBodyPopupDOM.delete(),t&&ChatMousePosBodyPopupDOM.delete(),ShowChatBoxDOM.tryHide();const s=DOMGetter.getChatHeadOthers(),a=DOMGetter.getChatHeadOthersOptions();let n=a.getElementsByClassName("chatHeadOptionSelect")[0];n.addEventListener("click",ChatGroupActivations.allChatSelected),n.addEventListener("click",ChatHead.deactivateChatHeadOthersOption),a.className="chatHeadOthersOptions",s.style.background="#D5D5D5";let o={functs:[["click",ChatHead.deactivateChatHeadOthersOption]]};MousePositionBodyPopupDOM.append(MousePositionBodyPopupDOM.create(o)),ChatMousePosBodyPopupDOM.append(ChatMousePosBodyPopupDOM.create(o))}static chatHeadChatFunc(){console.log("chatHeadChatFunc"),alert("function not available yet")}static chatHeadSearchChatFunc(e){const t=e.target;if(DOMGetter.getChatSearch()){let e="chatSearch not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}else ChatSearchDOM.append(ChatSearchDOM.create()),t.classList.add("hide")}}class MsgHead{static activateMessageHeadOthersOption(){const e=DOMGetter.getMousePositionBody(),t=DOMGetter.getChatMousePosBody();e&&MousePositionBodyPopupDOM.delete(),t&&ChatMousePosBodyPopupDOM.delete(),ShowChatBoxDOM.tryHide();let s=DOMGetter.getMessageHeadOthers(),a=document.getElementById("messageHeadOthersOptions"),n=a.getElementsByClassName("messageHeadOptionSelect")[0];n.addEventListener("click",MsgGroupActivations.allSelected_Megchecked),n.addEventListener("click",MsgHead.deactivateMessageHeadOthersOption),a.className="messageHeadOthersOptions",s.style.background="#D5D5D5";let o={functs:[["click",MsgHead.deactivateMessageHeadOthersOption]]};MousePositionBodyPopupDOM.append(MousePositionBodyPopupDOM.create(o)),ChatMousePosBodyPopupDOM.append(ChatMousePosBodyPopupDOM.create(o))}static deactivateMessageHeadOthersOption(){const e=DOMGetter.getMousePositionBody(),t=DOMGetter.getChatMousePosBody();e&&MousePositionBodyPopupDOM.delete(),t&&ChatMousePosBodyPopupDOM.delete(),ShowChatBoxDOM.tryUnhide();let s=DOMGetter.getMessageHeadOthers(),a=document.getElementById("messageHeadOthersOptions"),n=a.getElementsByClassName("messageHeadOptionSelect")[0];n.removeEventListener("click",MsgGroupActivations.allSelected_Megchecked),n.removeEventListener("click",MsgHead.deactivateMessageHeadOthersOption),a.className="hide",s.style.background=""}}class Private{static chatSearchBackFunc(){const e=DOMGetter.getChatSearch(),t=DOMGetter.getChatSearchBack(),s=DOMGetter.getChatSearchClear(),a=e.getElementsByClassName("chatSearchClose")[0],n=e.getElementsByClassName("chatSearchInput")[1];e.classList.remove("typingFocus"),t.classList.remove("arrow_back"),a.classList.remove("hide"),setTimeout((()=>{t.innerHTML="search"}),50),t.removeEventListener("click",Private.chatSearchBackFunc),s.removeEventListener("click",Private.chatSearchClearFunc),n.removeEventListener("keyup",Private.chatSearchInputTyping),e.addEventListener("click",ChatSearchFunc.clickChatSearchFunc),Private.chatSearchClearFunc()}static pushInMatchedChat(e,t){(e=Object.values(e).sort(((e,t)=>e.name-t.name))).forEach((e=>{ChatContainDOM.append(ChatContainDOM.create(e))}))}static chatSearchInputTyping(e){const t=DOMGetter.getChatSearchClear(),s=DOMGetter.getChatBody();let a=e.target,n=a.previousElementSibling;if("<br>"==a.innerHTML&&(a.innerHTML=""),a.innerHTML){ChatFuncs.setSearchingMode(!0),DOMGetter.getMessageHead()&&MsgSectionDOM.clear(!0),n.classList.add("hide"),t.classList.remove("hide"),ChatsDB.gotAllChats||(LoaderBackgroundDOM.append(s,LoaderBackgroundDOM.create(!0)),ContentLoaderDOM.append(s,ContentLoaderDOM.create(!0,"boxes",!0)),ChatFuncs.fetchChats(!0)),ChatBodyDOM.clear();let e=new RegExp(`^${a.innerHTML}`),o=ChatsDB.getChatsAsArr();o=o.filter((t=>{let s;return t.name.split(" ").forEach((t=>{s=s||e.test(t)})),s})),o[0]?Private.pushInMatchedChat(o,e):NoChatFoundDOM.append(NoChatFoundDOM.create())}else n.classList.remove("hide"),t.classList.add("hide"),ChatBodyDOM.clear(),ChatFuncs.pushInFetchedChat(),ChatFuncs.setSearchingMode(!1)}static chatSearchClearFunc(){const e=DOMGetter.getChatSearch(),t=DOMGetter.getChatSearchClear(),s=e.getElementsByClassName("chatSearchInput")[0],a=e.getElementsByClassName("chatSearchInput")[1],n=a.innerHTML;a.innerHTML="",s.classList.remove("hide"),t.classList.add("hide"),n&&(ChatBodyDOM.clear(),ChatFuncs.pushInFetchedChat()),ChatFuncs.setSearchingMode(!1)}}class ChatSearchFunc{static clickChatSearchFunc(e){let t=e.target,s="chatSearchBack"==t.id;"arrow_back"==t.innerHTML&&(s=!1);let a=t.classList.contains("chatSearchInput");if(s||a){const e=DOMGetter.getChatSearch(),t=DOMGetter.getChatSearchBack(),s=DOMGetter.getChatSearchClear(),a=e.getElementsByClassName("chatSearchClose")[0],n=e.getElementsByClassName("chatSearchInput")[1];e.classList.add("typingFocus"),t.classList.add("arrow_back"),a.classList.add("hide"),t.innerHTML="arrow_back",t.addEventListener("click",Private.chatSearchBackFunc),s.addEventListener("click",Private.chatSearchClearFunc),n.addEventListener("keyup",Private.chatSearchInputTyping),e.removeEventListener("click",ChatSearchFunc.clickChatSearchFunc)}}static chatSearchCloseFunc(){const e=DOMGetter.getChatHeadSearchChat();ChatSearchDOM.delete(),e.classList.remove("hide")}}class OnloadActivations{static groupActivations(){MsgGroupActivations.allMegSelectMoreOptions(),ChatGroupActivations.allChatsFunctions(),MsgGroupActivations.allMessageOntouchEvent(),ChatGroupActivations.allChatOntouchEvent(),OtherFunctions.activateMsgDateBeforeAfterfunc()}static chatHeadActivations(){const e=DOMGetter.getChatChatMinimize(),t=DOMGetter.getChatHeadChat(),s=DOMGetter.getChatHeadSearchChat(),a=DOMGetter.getChatHeadOthers(),n=DOMGetter.getChatHeadPix();e&&e.addEventListener("click",ChatHeadNormalDOM.onclickChatMinimizeBotton),t&&t.addEventListener("click",ChatHead.chatHeadChatFunc),s&&s.addEventListener("click",ChatHead.chatHeadSearchChatFunc),a&&a.addEventListener("click",ChatHead.activateChatHeadOthersOption),n&&n.addEventListener("click",ProfileFunc.viewMyProfilePicture)}static messageBodyActivations(e){let t,s,a,n;e?t=e.messageBody:(t=DOMGetter.getMessageBody(),s=DOMGetter.getShowChatBox(),a=DOMGetter.getCloseChatBox(),n=DOMGetter.getChatBoxTextMsg()),t&&t.addEventListener("scroll",MsgBody.activateMessageBodyOnscrollfunc),s&&s.addEventListener("click",ShowChatBoxDOM.onclick),a&&a.addEventListener("click",ChatBoxDOM.onclickCloseChatBoxButton),n&&n.addEventListener("keyup",ChatBoxDOM.typingMessage)}static messageHeadActivations(){const e=DOMGetter.getMessageChatMaximize(),t=DOMGetter.getMessageHeadOthers(),s=DOMGetter.getMessageHeadPix();e&&e.addEventListener("click",MessageHeadNormalDOM.onclickMessageChatMaximizeBotton),t&&t.addEventListener("click",MsgHead.activateMessageHeadOthersOption),s&&s.addEventListener("click",ProfileFunc.viewCurrentChatProfilePicture)}static onloadPage(){const e=DOMGetter.getPageSection();let t=document.getElementsByTagName("body")[0],s=e.getBoundingClientRect().height,a=t.scrollHeight,n=t.getBoundingClientRect().height;if(a>n){let t=a-n;e.style.height=s-t}}static messageHeadNormalElem(e){const t=e.messageChatMaximize,s=e.messageHeadOthers,a=e.messageHeadPix;t&&t.addEventListener("click",MessageHeadNormalDOM.onclickMessageChatMaximizeBotton),s&&s.addEventListener("click",MsgHead.activateMessageHeadOthersOption),a&&a.addEventListener("click",ProfileFunc.viewCurrentChatProfilePicture)}static chatHeadNormalElem(e){const t=e.chatChatMinimize,s=e.chatHeadChat,a=e.chatHeadSearchChat,n=e.chatHeadOthers,o=e.chatHeadPix;t&&t.addEventListener("click",ChatHeadNormalDOM.onclickChatMinimizeBotton),s&&s.addEventListener("click",ChatHead.chatHeadChatFunc),a&&a.addEventListener("click",ChatHead.chatHeadSearchChatFunc),n&&n.addEventListener("click",ChatHead.activateChatHeadOthersOption),o&&o.addEventListener("click",ProfileFunc.viewMyProfilePicture)}static chatSearchElem(e){const t=e.chatSearch,s=e.chatSearchClose;t&&t.addEventListener("click",ChatSearchFunc.clickChatSearchFunc),s&&s.addEventListener("click",ChatSearchFunc.chatSearchCloseFunc)}static chatboxReplyElem(e){const t=e.close;t&&t.addEventListener("click",ChatboxReplyDOM.close)}}const iconCreate=(e,t)=>{let s=document.createElement("div");return s.id=e,s.className="material-icons flexCenter",s.innerHTML=t,s};class ShowChatBoxDOM{static create(){let e=document.createElement("div");return e.id="showChatBox",e.className="material-icons flexCenter",e.innerHTML="near_me",e.addEventListener("click",ShowChatBoxDOM.onclick),e}static append(e){const t=DOMGetter.getMessage();if(t){let s=t.childNodes[0];t.insertBefore(e,s)}else{let e="messageElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static delete(e=!1){const t=DOMGetter.getShowChatBox();if(t)t.parentNode.removeChild(t);else if(!e){let e="ShowChatBoxElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static onclick(){let e=DOMGetter.getChatBox();e&&ChatBoxDOM.delete(),ShowChatBoxDOM.delete(),ChatBoxDOM.append(ChatBoxDOM.create()),e=DOMGetter.getChatBox(),e.style.display="flex"}static tryHide(){DOMGetter.getShowChatBox()&&ShowChatBoxDOM.delete()}static tryUnhide(){const e=DOMGetter.getChatBox(),t=DOMGetter.getShowChatBox();DOMGetter.getMessageHeadNormal()&&(e||t||ShowChatBoxDOM.append(ShowChatBoxDOM.create()))}}class MessageHeadDOM{static create(){let e=document.createElement("div");return e.id="messageHead",e}static append(e){const t=DOMGetter.getMessage();if(t)t.appendChild(e);else{let e="messageElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}}class MessageHeadNormalDOM{static create(){let e,t=ChatsDB.getChatObj(ChatsDB.activeChat),s=t.imgSrc,a=t.name,n=t.lastSeenString,o=document.createElement("div");o.id="messageHeadNormal";let l=document.createElement("div");l.id="messageChatMaximize",l.className="material-icons flexCenter",l.innerHTML="menu",o.appendChild(l);let r=document.createElement("div");r.id="messageHeadPix",e=document.createElement("img"),e.alt="pix",e.src=s,r.appendChild(e),o.appendChild(r);let i=document.createElement("div");i.id="messageHeadNameContain";let c=document.createElement("div");if(c.id="messageHeadName",c.innerHTML=a,i.appendChild(c),n){let e=document.createElement("div");e.id="messageHeadNameTime",e.innerHTML=n,i.appendChild(e)}o.appendChild(i);let d=document.createElement("div");d.id="messageHeadOthers",d.className="material-icons flexCenter",d.innerHTML="more_vert",o.appendChild(d);let g=document.createElement("div");g.id="messageHeadOthersOptions",g.className="hide";let h=document.createElement("p");h.className="messageHeadOptionSelect",h.innerHTML="Select",g.appendChild(h),o.appendChild(g);let M={messageChatMaximize:l,messageHeadOthers:d,messageHeadPix:r};return OnloadActivations.messageHeadNormalElem(M),o}static append(e){const t=DOMGetter.getMessageHead();if(t)t.appendChild(e);else{let e="messageHeadElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static delete(){const e=DOMGetter.getMessageHeadNormal();if(e)e.parentNode.removeChild(e);else{let e="messageHeadNormalElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static onclickMessageChatMaximizeBotton(){const e=DOMGetter.getChat(),t=DOMGetter.getMessage(),s=DOMGetter.getMessageChatMaximize(),a=DOMGetter.getMsgSelectAChat();let n="65%";window.innerWidth<=500&&(n="100%"),t.style.width=n,e.style.display="flex",s&&(s.style.display="none"),a&&(a.getElementsByClassName("selectAChatBtn")[0].style.display="")}static createLastSeen(e){let t=document.createElement("div");return t.id="messageHeadNameTime",t.innerHTML=e,t}static appendLastSeen(e){let t;if(DOMGetter.getMessageHeadNormal()){if(t=document.getElementById("messageHeadNameContain"),!t){let e="messageHeadNameContainElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);return void(a&&console.log(a))}t.appendChild(e)}else{let e="messageHeadNormalElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static deleteLastSeen(){const e=document.getElementById("messageHeadNameTime");if(e)e.parentNode.removeChild(e);else{let e="messageHeadNameTimeElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}}class MessageHeadSelectedDOM{static create(){let e=document.createElement("div");e.id="messageHeadSelected";let t=document.createElement("div");t.id="messageHeadBack",t.className="material-icons flexCenter",t.innerHTML="arrow_back",e.appendChild(t);let s=document.createElement("div");return s.id="messageHeadCount",s.className="flexCenter",s.innerHTML="0",e.appendChild(s),e}static append(e){const t=DOMGetter.getMessageHead();if(t)t.appendChild(e);else{let e="messageHeadElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static delete(){const e=DOMGetter.getMessageHeadSelected();if(e)e.parentNode.removeChild(e);else{let e="msgHeadSelectedElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static loadIcons(e=null){const t=Settings.MessageOptions;if(e||(e=DOMGetter.getMessageHeadSelected()),t.headReplyMessage){let t=MessageHeadSelectedDOM.createMsgHeadReplyIcon();e.appendChild(t)}if(t.groupDelMessage){let t=MessageHeadSelectedDOM.createMsgHeadDelIcon();e.appendChild(t)}if(t.groupFowardMessage){let t=MessageHeadSelectedDOM.createMsgHeadFowardIcon();e.appendChild(t)}if(t.groupCopyMessage){let t=MessageHeadSelectedDOM.createMsgHeadCopyIcon();e.appendChild(t)}if(t.groupStarMessage){let t=MessageHeadSelectedDOM.createMsgHeadStarIcon();e.appendChild(t)}if(t.headMsgInfo){let t=MessageHeadSelectedDOM.createMsgHeadInfoIcon();e.appendChild(t)}let s=MessageHeadSelectedDOM.createMsgHeadOthersSIcon();return e.appendChild(s),e}static clearIcons(){let e=DOMGetter.getMessageHeadReply(),t=DOMGetter.getMessageHeadDelete(),s=DOMGetter.getMessageHeadFoward(),a=DOMGetter.getMessageHeadCopy(),n=DOMGetter.getMessageHeadStar(),o=DOMGetter.getMessageHeadInfo(),l=DOMGetter.getMessageHeadOthersS();e&&MessageHeadSelectedDOM.deleteIcon(e),t&&MessageHeadSelectedDOM.deleteIcon(t),s&&MessageHeadSelectedDOM.deleteIcon(s),a&&MessageHeadSelectedDOM.deleteIcon(a),n&&MessageHeadSelectedDOM.deleteIcon(n),o&&MessageHeadSelectedDOM.deleteIcon(o),l&&MessageHeadSelectedDOM.deleteIcon(l)}static appendIcon(e){const t=DOMGetter.getMessageHeadSelected();if(!t){let e="messageHeadSelectedDOM not found",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}const s=DOMGetter.getMessageHeadOthersS();s?t.insertBefore(e,s):t.appendChild(e)}static deleteIcon(e){if(!e){let e="iconElem not found",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}const t=e.parentElement;if(t)if("messageHeadSelected"==t.id)t.removeChild(e);else{let e="got the wrong element",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}else{let e="messageHeadSelectedDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static createMsgHeadReplyIcon(){let e=iconCreate("messageHeadReply","reply");return e.addEventListener("click",MsgHeadSelecOpts.replyMessages),e}static createMsgHeadDelIcon(){let e=iconCreate("messageHeadDelete","delete");return e.addEventListener("click",MsgHeadSelecOpts.deleteMessages),e}static createMsgHeadFowardIcon(){let e=iconCreate("messageHeadFoward","reply");return e.addEventListener("click",MsgHeadSelecOpts.fowardMessages),e}static createMsgHeadCopyIcon(){let e=iconCreate("messageHeadCopy","content_copy");return e.addEventListener("click",MsgHeadSelecOpts.copyMessages),e}static createMsgHeadStarIcon(){let e=iconCreate("messageHeadStar","grade");return e.addEventListener("click",MsgHeadSelecOpts.starMessages),e}static createMsgHeadInfoIcon(){let e=iconCreate("messageHeadInfo","description");return e.addEventListener("click",MsgHeadSelecOpts.getMessagesInfo),e}static createMsgHeadOthersSIcon(){let e=iconCreate("messageHeadOthersS","more_vert");return e.addEventListener("click",MsgHeadSelecOpts.activateMessageHeadOthersS),e}}class MsgGroupActivations{static megSelectMoreOptions(e){let t=DOMGetter.getMessageBody(),s=DOMGetter.getChatBox();const a=DOMGetter.getMousePositionBody(),n=DOMGetter.getChatMousePosBody();let o;a&&MousePositionBodyPopupDOM.delete(),n&&ChatMousePosBodyPopupDOM.delete(),ShowChatBoxDOM.tryHide();let l=e.target;for(;!l.classList.contains("megMore");)l=l.parentElement;o=l.getElementsByClassName("subMsgMore")[0],l.removeEventListener("click",MsgGroupActivations.megSelectMoreOptions),o.removeEventListener("click",MsgGroupActivations.megSelectMoreOptions);let r=l.dataset.id;const i=MsgMoreOptionsDOM.create(r);MsgMoreOptionsDOM.append(r,i),l.style.display="flex",i.style.top&&(i.style.top="0");let c,d=t.getBoundingClientRect(),g=i.getBoundingClientRect(),h=l.getBoundingClientRect();s&&(c=s.getBoundingClientRect());let M,m=h.height+"px";if(i.style.top=m,g=i.getBoundingClientRect(),M=s?d.bottom-c.height:d.bottom,M<g.bottom){let e=null;if(o.classList.add("optionUp"),h.top-d.top>=g.height){let t;e=!0,t=s?g.height-c.height/2.5+"px":g.height-.08*g.height+"px",t="-"+t,i.style.top=t}if(!e){let e=g.bottom-M;t.scrollTo(t.scrollLeft,t.scrollTop+e)}}let u={functs:[["click",MsgGroupDeactivations.megSelectMoreOptions]]};MousePositionBodyPopupDOM.append(MousePositionBodyPopupDOM.create(u)),ChatMousePosBodyPopupDOM.append(ChatMousePosBodyPopupDOM.create(u))}static allMessageOntouchEvent(e=null){if(e)e.addEventListener("touchstart",MsgBody.touchedThisMessage);else{let e=document.getElementsByClassName("messageContainer");for(let t=0;t<e.length;t++)e[t].addEventListener("touchstart",MsgBody.touchedThisMessage)}}static allMegSelectMoreOptions(e=null){if(e)e.getElementsByClassName("megMore")[0].addEventListener("click",MsgGroupActivations.megSelectMoreOptions);else{let e=document.getElementsByClassName("megMore");for(let t=0;t<e.length;t++)e[t].addEventListener("click",MsgGroupActivations.megSelectMoreOptions)}}static allSelected_Megchecked(e=null){if(e&&e.id){const t=ChatFuncs.getActiveChat();let s=e.getElementsByClassName("selected")[0],a=e.getElementsByClassName("Megchecked")[0];if(s){let e=s.dataset.id;MessageFuncs.msgIsDeleting(t,e)||(s.style.display="block",s.addEventListener("click",MsgBody.selectUnselectMessage),s.addEventListener("touchstart",MsgBody.selectUnselectMessage))}if(a){let e=a.dataset.id;MessageFuncs.msgIsDeleting(t,e)||(a.style.display="flex")}}else{ChatGroupDeactivations.allChatSelected(),MsgBody.emptySelectedMessagesID();const e=ChatFuncs.getActiveChat();setTimeout((()=>{ShowChatBoxDOM.tryHide()}),50);let t=DOMGetter.getMessageHeadNormal(),s=DOMGetter.getMessageHeadSelected(),a=DOMGetter.getMessageHeadBack();MessageFuncs.setIsSelectingMsgs(!0);let n=document.getElementsByClassName("selected"),o=document.getElementsByClassName("Megchecked");for(let t=0;t<n.length;t++){let s=!0,a=n[t].dataset.id;MessageFuncs.msgIsDeleting(e,a)&&(s=!1),s&&(n[t].style.display="block",n[t].addEventListener("click",MsgBody.selectUnselectMessage),n[t].addEventListener("touchstart",MsgBody.selectUnselectMessage))}for(let t=0;t<o.length;t++){let s=!0,a=o[t].dataset.id;MessageFuncs.msgIsDeleting(e,a)&&(s=!1),s&&(o[t].style.display="flex")}MessageHeadSelectedDOM.loadIcons(),t.style.display="none",s.style.display="flex",a.addEventListener("click",MsgGroupDeactivations.allSelected_Megchecked)}}}class MsgBody{static getElemAbsolutePos(e,t=!1){if(t){let t=MsgBody.makeMsgIDUsable(e);e=document.getElementById(t)}return e.getBoundingClientRect()}static setElemAbsolutePos(e,t,s=!1){if(s){let e=MsgBody.makeMsgIDUsable(t);t=document.getElementById(e)}let a=e.top;if(!e.left||!a){let e="invalid pos param",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}const n=DOMGetter.getMessageBody();let o=t.getBoundingClientRect().top-a;n.scrollTo(n.scrollLeft,n.scrollTop+o)}static touchedThisMessageThenDrag(e){clearTimeout(GlobalVars.megChatTouchedTimeOut);let t=DOMGetter.getMessageBody(),s=t.getBoundingClientRect(),a=e.touches[0].clientY,n=GlobalVars.touchYPos-a;s.top<=a&&s.bottom>=a&&t.scrollTo(t.scrollLeft,t.scrollTop+n),GlobalVars.touchYPos=a}static touchedThisMessage(e){e.preventDefault();let t=DOMGetter.getMessageHeadCount();GlobalVars.touchYPos=e.touches[0].clientY;let s=e.target;if(!s.dataset.id)for(;!s.dataset.id;)s=s.parentElement;let a=s.dataset.id;a=MsgBody.makeMsgIDUsable(a);let n=MessageFuncs.getMsgSenderClass(ChatFuncs.getActiveChat(),a);GlobalVars.megChatTouchedTimeOut=setTimeout((()=>{MsgGroupActivations.allSelected_Megchecked(),MsgGroupDeactivations.removeAllSelectedHoverEffect();let s=document.getElementsByName(a)[0],o=document.getElementsByName(a)[1].getElementsByTagName("input")[0];MsgBody.updateSelectedMessagesID(a,n),t.innerHTML=GlobalVars.selectedMessagesID.length,s.classList.add("s"),o.setAttribute("checked","true"),e.target.removeEventListener("touchend",OtherFunctions.clearMegChatTouchedTimeOut),e.target.removeEventListener("touchcancel",OtherFunctions.clearMegChatTouchedTimeOut),e.target.removeEventListener("touchmove",MsgBody.touchedThisMessageThenDrag)}),1e3),e.target.addEventListener("touchend",OtherFunctions.clearMegChatTouchedTimeOut),e.target.addEventListener("touchcancel",OtherFunctions.clearMegChatTouchedTimeOut),e.target.addEventListener("touchmove",MsgBody.touchedThisMessageThenDrag)}static selectUnselectMessage(e){let t=DOMGetter.getMessageHeadCount();const s=ChatFuncs.getActiveChat();let a=e.target,n=a.nextElementSibling.getElementsByTagName("input")[0],o=a.dataset.id;o=MsgBody.makeMsgIDUsable(o);let l=MessageFuncs.getMsgSenderClass(s,o);MsgBody.updateSelectedMessagesID(o,l,s)?(a.classList.add("s"),n.setAttribute("checked","true")):(a.classList.remove("s"),n.removeAttribute("checked")),t.innerHTML=GlobalVars.selectedMessagesID.length}static activateMessageBodyOnscrollfunc(){let e=DOMGetter.getShowChatBox(),t=DOMGetter.getMessageBody(),s=DOMGetter.getMsgDate();if(e){let s=t.scrollTop;GlobalVars.megBdScrlTop&&(s>GlobalVars.megBdScrlTop?(e.style.top="65px",e.style.bottom="none"):(e.style.top="",e.style.bottom="")),GlobalVars.megBdScrlTop=s}let a=t.getBoundingClientRect().top,n=t.getElementsByClassName("Be")[0],o=t.getElementsByClassName("Af")[0];n&&n.getBoundingClientRect().top>=a&&(s.innerHTML=OtherFunctions.getMsgDateBeforeBeforefunc(n.innerHTML),n.classList.remove("Be"),o&&o.classList.remove("Af"),OtherFunctions.activateMsgDateBeforeAfterfunc()),o&&o.getBoundingClientRect().top<=a&&(s.innerHTML=o.innerHTML,n&&n.classList.remove("Be"),o.classList.remove("Af"),OtherFunctions.activateMsgDateBeforeAfterfunc()),s.classList.add("add"),clearTimeout(GlobalVars.msgDateTimeOutFunction),GlobalVars.msgDateTimeOutFunction=setTimeout((()=>{s.classList.remove("add")}),1e3)}static updateSelectedMessagesID(e,t,s=null){let a=DOMGetter.getMessageHeadReply(),n=DOMGetter.getMessageHeadInfo();if(s||(s=ChatFuncs.getActiveChat()),e=MsgBody.makeMsgIDUsable(e),MessageFuncs.msgIsDeleting(s,e)){let e="funtio is not supposed to run",t="",s=MyCodeErr.announce(e,t,!1,!0);return void(s&&console.log(s))}let o=GlobalVars.selectedMessagesID.indexOf(e),l=!1;return o<0?(GlobalVars.selectedMessagesID.push(e),GlobalVars.msgSenderTracking.push(t),l=!0):(GlobalVars.selectedMessagesID.splice(o,1),GlobalVars.msgSenderTracking.splice(o,1)),a&&(GlobalVars.selectedMessagesID.length>1?a.classList.add("hide"):a.classList.remove("hide")),n&&(GlobalVars.selectedMessagesID.length>1?n.classList.add("hide"):n.classList.remove("hide")),l}static msgIsSelected(e){return e=MsgBody.makeMsgIDUsable(e),GlobalVars.selectedMessagesID.indexOf(e),!0}static emptySelectedMessagesID(){(GlobalVars.selectedMessagesID||GlobalVars.msgSenderTracking)&&(GlobalVars.selectedMessagesID.splice(0,GlobalVars.selectedMessagesID.length),GlobalVars.msgSenderTracking.splice(0,GlobalVars.msgSenderTracking.length))}static jumpToMsgByID(e,t=!1){e=MsgBody.makeMsgIDUsable(e);const s=document.getElementById(e);if(!s){let e="msgContain not found",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}const a=DOMGetter.getMessageBody(),n=s.getBoundingClientRect(),o=a.getBoundingClientRect(),l=n.top-o.top;t?a.scroll({top:l,behavior:"smooth"}):a.scrollTo(a.scrollLeft,l)}static checkIfUnseenMsgsAreSeenOnload(e){let t=null,s=null,a=null,n=UnseenMsgIDs.get(e),o=0;for(;o<n.length&&!s&&!a;){const e=n[o],l=MsgBody.msgIsSeeable(e);null!==l?l?t=e:s=e:a=!0,o++}if(a){let e="fatal error",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}else t&&MessageFuncs.sendMsgSeenSignal(e,t,!0)}static msgIsSeeable(e){let t=null;e=MsgBody.makeMsgIDUsable(e);const s=document.getElementById(e);if(!s)return t;const a=DOMGetter.getMessageBody(),n=s.getBoundingClientRect(),o=a.getBoundingClientRect(),l=.3*n.height;return t=o.bottom-n.top>=l,t}static jumpToBottom(e=!1){const t=DOMGetter.getMessageBody();e?t.scroll({top:t.scrollHeight,behavior:"smooth"}):t.scrollTo(t.scrollLeft,t.scrollHeight)}static scrlMsgBodyToSeeMsg(){const e=ChatFuncs.getActiveChat(),t=UnseenMsgIDs.get(e);if(!t[0])return;let s=null,a=null,n=0;for(;n<t.length&&!s&&!a;){const o=t[n],l=MsgBody.msgIsSeeable(o);null!==l?l?MessageFuncs.sendMsgSeenSignal(e,o):s=o:a=!0,n++}if(a){let e="couldNotFindMsgDOM not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static getFirstMsgOnDomId(){return document.getElementsByClassName("msgWrapper")[0].id}static sendMsg(e){let t;const s=ChatFuncs.getActiveChat(),a=(DOMGetter.getChatBox(),ChatBoxDB.getChatBoxAttr(s));if(!a){let e="chatBoxAttr not found",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}const n=a.msg,o=a.rMsg;if(o&&(t=o.msgID),!n){let e="Please type your message",t="",s=MyCodeErr.announce(e,t,!0);return void(s&&console.log(s))}const l=MsgOnSendingDB.addMsgOnSending(s,a),r=MsgOnSendingDB.getMsgSendingInstance(s,l);ChatBoxDOM.onclickCloseChatBoxButton(),MessageFuncs.sendMsg(r)}static makeMsgIDUsable(e){return/msg/.test(e)||(e="msg-"+e),e}static makeMsgID_DB_Usable(e){return/msg/.test(e)&&(e=e.split("msg-").splice(-1)[0]),e}}const deletedMsgText={1:"deleted",2:"deleted",3:"deleted",4:"deleted"};class MsgOnSendingInstance{constructor(e){this._chatID=e.chatID,this._msgSendingID=e.msgSendingID,this._msg=e.msg,this._isSender=!0,this._date=new Date,this._date=Date.parse(this._date),e.rMsg&&(this._rMsg=new ReplyedMegInstance(e.rMsg))}get chatID(){return this._chatID}get msgSendingID(){return this._msgSendingID}get msg(){return this._msg}get isSender(){return this._isSender}get date(){return this._date}get dateSentString(){return TimeFunctions.generateTimeSentStringT1(this.date)}get rMsg(){return this._rMsg}set chatID(e){}set msgSendingID(e){}set msg(e){}set isSender(e){}set date(e){}set dateSentString(e){}set rMsg(e){}getMsgOnSending(){return this}}class MsgOnSendingDBInstance{constructor(){this._msgsOnSending={}}getChatMsgsOnSending(e){const t=ChatBody.makeChatID_DB_Usable(e);return this.msgsOnSending[t]}getMsgSendingInstance(e,t){return this.msgsOnSending[e][t]}get msgsOnSending(){return this._msgsOnSending}set msgsOnSending(e){}addMsgOnSending(e,t){const s=ChatBody.makeChatID_DB_Usable(e);if(this.msgsOnSending[s]||(this.msgsOnSending[s]={}),t.msgSendingID=Math.round(15890652e5*Math.random()),this.msgsOnSending[s][t.msgSendingID]=new MsgOnSendingInstance(t),ChatFuncs.isActiveChat(s)){let e=this.msgsOnSending[s][t.msgSendingID];MessageFuncs.pushInMsgSending(s,e)}return t.msgSendingID}deleteMsgOnSending(e,t){const s=ChatBody.makeChatID_DB_Usable(e);if(t=MsgBody.makeMsgID_DB_Usable(t),delete this.msgsOnSending[s][t],this.msgsOnSending[s][t]){let e="failed to delete msg sending",t="",s=MyCodeErr.announce(e,t);return s&&console.log(s),!1}return!0}getMsgOnSendingObj(e,t,s=!1){const a=ChatBody.makeChatID_DB_Usable(e);return t=MsgBody.makeMsgID_DB_Usable(t),s?!!this.msgsOnSending[a][t]:this.msgsOnSending[a][t].getMsgOnSending()}getChatMsgOnSendingAsArr(e){const t=ChatBody.makeChatID_DB_Usable(e);let s=this.getChatMsgsOnSending(t);return s?(s=Object.values(s),s=s.sort(((e,t)=>e.date-t.date)),s):[]}hasMsgSending(e){return!!this.getChatMsgOnSendingAsArr(e)&&!!this.getChatMsgOnSendingAsArr(e)[0]}}class ChatBoxReplyMsgInstance{constructor(e){if(e.chatID)if(e.msgID)this._chatID=ChatBody.makeChatID_DB_Usable(e.chatID),this._msgID=e.msgID,this._isSender=e.isSender,this._msg=e.msg;else{let e="incomplete rMsg param",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}else{let e="incomplete rMsg param",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}get chatID(){return this._chatID}get msgID(){return this._msgID}get isSender(){return this._isSender}get msg(){return this._msg}get senderName(){return this._isSender?"You":ChatFuncs.getChatObj(this._chatID).name}set chatID(e){}set msgID(e){}set isSender(e){}set msg(e){}set senderName(e){}}class ChatBoxAttributeInstance{constructor(e,t,s){this._chatID=ChatBody.makeChatID_DB_Usable(e),this._msg=t||"",this._rMsg=s?new ChatBoxReplyMsgInstance(s):null}get chatID(){return this._chatID}get msg(){return this._msg}get rMsg(){return this._rMsg}set chatID(e){}set msg(e){this._msg=e}set rMsg(e){this._rMsg=e?new ChatBoxReplyMsgInstance(e):null}}class ChatBoxDBInstance{constructor(){this._chatBoxsAttr={}}getChatBoxAttr(e){const t=ChatBody.makeChatID_DB_Usable(e);return this.chatBoxsAttr[t]}getRMsgObj(e){const t=ChatBody.makeChatID_DB_Usable(e);if(!this.chatBoxsAttr[t]){let e="some error occored",t="",s=MyCodeErr.announce(e,t);return s&&console.log(s),null}const s=this.chatBoxsAttr[t].rMsg;if(!s){let e="some error occoured",t="",s=MyCodeErr.announce(e,t);return s&&console.log(s),null}return s}get chatBoxsAttr(){return this._chatBoxsAttr}set chatBoxsAttr(e){}chatHasChatBox(e){const t=ChatBody.makeChatID_DB_Usable(e);return!!this.chatBoxsAttr[t]}addChatBoxAttr(e,t,s){const a=ChatBody.makeChatID_DB_Usable(e);this.chatBoxsAttr[a]=new ChatBoxAttributeInstance(e,t,s)}deleteRMsgObj(e){const t=ChatBody.makeChatID_DB_Usable(e);if(this.chatBoxsAttr[t]){if(this.chatBoxsAttr[t].rMsg=null,this.chatBoxsAttr[t].rMsg){let e="some error occoured",t="",s=MyCodeErr.announce(e,t);return s&&console.log(s),!1}return!0}console.log("unnessary")}addRMsgObj(e,t){const s=ChatBody.makeChatID_DB_Usable(e);this.chatBoxsAttr[s]||ChatBoxDB.addChatBoxAttr(s,"",null),this.chatBoxsAttr[s].rMsg=t}updateMsg(e,t){const s=ChatBody.makeChatID_DB_Usable(e);this.chatBoxsAttr[s]||ChatBoxDB.addChatBoxAttr(s,"",null),this.chatBoxsAttr[s].msg=t}deleteChatBoxAttr(e){const t=ChatBody.makeChatID_DB_Usable(e);if(this.chatBoxsAttr[t]){if(delete this.chatBoxsAttr[t],this.chatBoxsAttr[t]){let e="some error occoured",t="",s=MyCodeErr.announce(e,t);return s&&console.log(s),!1}return!0}console.log("unnessary")}}class ReplyedMegInstance{constructor(e){this._chatID=e.chatID,this._msgID=e.msgID,this._isSender=e.isSender,this._msg=e.msg,this._senderName=e.senderName}get chatID(){return this._chatID}get msgID(){return this._msgID}get isSender(){return this._isSender}get msg(){return this._msg}get senderName(){return this._isSender?"You":ChatFuncs.getChatObj(this._chatID).name}set chatID(e){}set msgID(e){}set isSender(e){}set msg(e){}set senderName(e){}}class MessageInstance{constructor(e,t,s=!0){let a=null,n=null;t&&(a=t.senderID,n=t.dateSentString),this._chatID=e.chatID,this._msgID=e.msgID,this._msg=e.msg,this._isSender=e.isSender,this._senderID=e.senderID,this._timeSent=e.timeSent,this._timeSentString=TimeFunctions.generateTimeSentStringT2(this.timeSent),this._first=!s||null===n||this.senderID!=a||this.dateSentString!=n,this._read=e.read,this._stared=e.stared,this._deliverTime=e.deliverTime,this._readTime=e.readTime,this._drtime=[TimeFunctions.generateTimeSentStringT1(this.deliverTime),TimeFunctions.generateTimeSentStringT1(this.readTime)],this._deleted=e.deleted,e.replyedMegObj&&(this._replyedMegObj=new ReplyedMegInstance(e.replyedMegObj)),this._isStaring=!1,this._isDeleting=!1}get chatID(){return this._chatID}get msgID(){return this._msgID}get msg(){return this._msg}get isSender(){return this._isSender}get senderID(){return this._senderID}get timeSent(){return this._timeSent}get timeSentString(){return this._timeSentString}get dateSentString(){return TimeFunctions.generateTimeSentStringT1(this.timeSent)}get first(){return this._first}get read(){return this._read}get stared(){return this._stared}get deliverTime(){return this._deliverTime}get readTime(){return this._readTime}get drtime(){return this._drtime}get deleted(){return this._deleted}get deletedText(){return deletedMsgText[this._deleted]}get replyedMegObj(){return this._replyedMegObj}get isStaring(){return!!this._isStaring}get isDeleting(){return!!this._isDeleting}set chatID(e){}set msgID(e){}set msg(e){}set isSender(e){}set senderID(e){}set timeSent(e){}set timeSentString(e){}set dateSentString(e){}set first(e){this._first=e}set read(e){this._read=e}set stared(e){this._stared=e}set deliverTime(e){this._deliverTime=e,this._drtime[0]=TimeFunctions.generateTimeSentStringT1(this.deliverTime)}set readTime(e){e&&(this._readTime=e,this._drtime[1]=TimeFunctions.generateTimeSentStringT1(this.readTime))}set drtime(e){}set deleted(e){this._deleted=e}set deletedText(e){}set replyedMegObj(e){}set isStaring(e){this._isStaring=!!e}set isDeleting(e){this._isDeleting=!!e}getMessage(){return this}get senderClass(){return this.isSender?"you":"notYou"}set senderClass(e){}deleteThisMessage(e){this.deleted=e,this._msg=null,this._replyedMegObj=null,this._timeSentString=null,this._read=null,this._stared=null,this._deliverTime=null,this._readTime=null,this._drtime=null}}class MessagesDBInstance{constructor(){this._messages={},this.unseenMsgIDs={},this.gotAllMsgsStatus={},this._msgInfoInView={},this._isSelectingMsgs}getChatMessages(e){const t=ChatBody.makeChatID_DB_Usable(e);return this.messages[t]}getSenderClass(e,t){const s=ChatBody.makeChatID_DB_Usable(e);return t=MsgBody.makeMsgID_DB_Usable(t),this.getMsgInstance(s,t).senderClass}get msgInfoInView(){return this._msgInfoInView}set msgInfoInView(e){}setMsgInfoInView(e,t){const s=ChatBody.makeChatID_DB_Usable(e);t=MsgBody.makeMsgID_DB_Usable(t),this._msgInfoInView.chatID=s,this._msgInfoInView.msgID=t}getMsgInstance(e,t){const s=ChatBody.makeChatID_DB_Usable(e);return t=MsgBody.makeMsgID_DB_Usable(t),this.messages[s][t]}get messages(){return this._messages}set messages(e){}get isSelectingMsgs(){return this._isSelectingMsgs}set isSelectingMsgs(e){this._isSelectingMsgs=!0===e||"true"===e}deleteChat(e){const t=ChatBody.makeChatID_DB_Usable(e);delete this.messages[t]}deleteMessage(e,t,s){const a=ChatBody.makeChatID_DB_Usable(e);t=MsgBody.makeMsgID_DB_Usable(t),s&&this.messages[a][t].deleteThisMessage(s)}addMessage(e,t,s=!0){const a=ChatBody.makeChatID_DB_Usable(e);let n=null;this.messages[a]?(n=Object.values(this.messages[a]),n=n[n.length-1]):(this.messages[a]={},this.gotAllMsgsStatus[a]=!1,s&&(ChatFuncs.chatObjIsAvailable(a)||ChatFuncs.fetchChatByID(a))),this.messages[a][t.msgID]=new MessageInstance(t,n);let o=this.messages[a][t.msgID];if(o.isSender||"read"==o.read||UnseenMsgIDs.add(a,t.msgID),s&&(ChatFuncs.updateChatLastMsgObj(a,t),ChatFuncs.updateChatUnreadMsgCount(a)),ChatFuncs.isActiveChat(a)){let e=this.messages[a][t.msgID];MessageFuncs.pushInNewMsg(a,e,n)}}convertMsgSendingToMsg(e){const t=ChatBody.makeChatID_DB_Usable(e.chatID),s=e.msgSendingID;MsgOnSendingDB.deleteMsgOnSending(t,s),this.messages[t][e.msgID]=new MessageInstance(e,null),MessageFuncs.correctFirstStatus(t,e.msgID)}addOldMessage(e,t){const s=ChatBody.makeChatID_DB_Usable(e);let a=null;this.messages[s]?(a=Object.values(this.messages[s]),a=a[0]):(this.messages[s]={},this.gotAllMsgsStatus[s]=!1),this.messages[s][t.msgID]=new MessageInstance(t,null,!1);let n=this.messages[s][t.msgID];this.messages[s][a.msgID].first=n.senderID!=a.lastSender||n.dateSentString!=a.lastMsgDate}getMessageObj(e,t,s=!1){const a=ChatBody.makeChatID_DB_Usable(e);if(t=MsgBody.makeMsgID_DB_Usable(t),s)return!!this.messages[a][t];if(!this.messages[a][t]){let e="some error occoured",t="",s=MyCodeErr.announce(e,t);return s&&console.log(s),null}return this.messages[a][t].getMessage()}getStaredStatus(e,t){const s=ChatBody.makeChatID_DB_Usable(e);return t=MsgBody.makeMsgID_DB_Usable(t),this.messages[s][t].stared}getReadStatus(e,t){const s=ChatBody.makeChatID_DB_Usable(e);return t=MsgBody.makeMsgID_DB_Usable(t),this.messages[s][t].read}getMsgDelStatus(e,t){const s=ChatBody.makeChatID_DB_Usable(e);return t=MsgBody.makeMsgID_DB_Usable(t),this.messages[s][t].deleted}getIsSenderStatus(e,t){const s=ChatBody.makeChatID_DB_Usable(e);return t=MsgBody.makeMsgID_DB_Usable(t),this.messages[s][t].isSender}userIsSender(e,t){const s=ChatBody.makeChatID_DB_Usable(e);return t=MsgBody.makeMsgID_DB_Usable(t),this.messages[s][t].isSender}getFirstStatus(e,t){const s=ChatBody.makeChatID_DB_Usable(e);return t=MsgBody.makeMsgID_DB_Usable(t),this.messages[s][t].first}setReadStatus(e,t,s,a){const n=ChatBody.makeChatID_DB_Usable(e);t=MsgBody.makeMsgID_DB_Usable(t),this.messages[n][t].read=s,"read"==s&&(this.messages[n][t].readTime=a)}setStaredStatus(e,t,s){const a=ChatBody.makeChatID_DB_Usable(e);t=MsgBody.makeMsgID_DB_Usable(t),this.messages[a][t].stared=s}setDeliverTime(e,t,s){const a=ChatBody.makeChatID_DB_Usable(e);t=MsgBody.makeMsgID_DB_Usable(t),this.messages[a][t].deliverTime=s}setMsgInfoInView(e,t){const s=ChatBody.makeChatID_DB_Usable(e);t=MsgBody.makeMsgID_DB_Usable(t),this.msgInfoInView.chatID=s,this.msgInfoInView.msgID=t}isLastMsgInDB(e,t){const s=ChatBody.makeChatID_DB_Usable(e);t=MsgBody.makeMsgID_DB_Usable(t);const a=this.messages[s][t].timeSent;let n=t==ChatFuncs.getChatLastMsgObj(s).msgID,o=a==ChatFuncs.getChatLastMsgObj(s).timeSent;return console.log(n,o),n&&o}getChatMsgsAsArr(e){const t=ChatBody.makeChatID_DB_Usable(e);let s=this.getChatMessages(t);return s=Object.values(s),s}gotAllMsgs(e){const t=ChatBody.makeChatID_DB_Usable(e);return this.gotAllMsgsStatus[t]}setMsgIsStaring(e,t,s){const a=ChatBody.makeChatID_DB_Usable(e);t=MsgBody.makeMsgID_DB_Usable(t),this.messages[a][t].isStaring=s}setMsgIsDeleting(e,t,s){const a=ChatBody.makeChatID_DB_Usable(e);t=MsgBody.makeMsgID_DB_Usable(t),this.messages[a][t].isDeleting=s}msgIsStaring(e,t){const s=ChatBody.makeChatID_DB_Usable(e);return t=MsgBody.makeMsgID_DB_Usable(t),this.messages[s][t].isStaring}msgIsDeleting(e,t){const s=ChatBody.makeChatID_DB_Usable(e);return t=MsgBody.makeMsgID_DB_Usable(t),this.messages[s][t].isDeleting}}const MessagesDB=new MessagesDBInstance,MsgOnSendingDB=new MsgOnSendingDBInstance,ChatBoxDB=new ChatBoxDBInstance;class LastMsgInstance{constructor(e){this._msgID=e.msgID,this._lastMsg=e.lastMsg,this._timeSent=e.timeSent,this._read=e.read,this._isSender=e.isSender,this._timeSentString=TimeFunctions.generateTimeSentStringT1(e.timeSent),this._deletedText=e.deletedText,this._lastMsg||(this._lastMsg=e.msg)}get msgID(){return this._msgID}get lastMsg(){return this._lastMsg}get timeSent(){return this._timeSent}get read(){return this._read}get isSender(){return this._isSender}get timeSentString(){return this._timeSentString}get deletedText(){return this._deletedText}set msgID(e){}set lastMsg(e){this._lastMsg=e}set timeSent(e){this._timeSent=e,this._timeSentString=TimeFunctions.generateTimeSentStringT1(e)}set read(e){this._read=e}set isSender(e){this._isSender=e}set timeSentString(e){}set deletedText(e){}}class ChatInstance{constructor(e){this._chatID=e.chatID,this._profileID=e.profileID,this._pined=e.pined,this._pinedTime=e.pinedTime,e.lastMsgObj?this._lastMsgObj=new LastMsgInstance(e.lastMsgObj):this._lastMsgObj=null,this._isPinning=!1,this._isDeleting=!1;const t=e.messages;t.forEach((t=>{MessagesDB.addMessage(e.chatID,t,!1),this._lastMsgObj=new LastMsgInstance(t)})),t.length<10&&(MessagesDB.gotAllMsgsStatus[e.chatID]=!0)}get chatID(){return this._chatID}get profileID(){return this._profileID}get imgSrc(){return ProfilesDB.getP_pix(this.profileID)}get name(){return ProfilesDB.getName(this.profileID)}get unreadMsgCount(){return UnseenMsgIDs.count(this.chatID)}get pined(){return this._pined}get pinedTime(){return this._pinedTime}get sortTime(){return this.pinedTime?1e3*this.pinedTime:this._lastMsgObj?this._lastMsgObj.timeSent:0}get lastSeen(){return ProfilesDB.getLastSeen(this.profileID)}get recieverIsOnline(){return ProfilesDB.isOnline(this.profileID)}get lastSeenString(){return this.lastSeen?"online"==this.lastSeen?"online":TimeFunctions.generateTimeSentStringT1(this.lastSeen):null}get lastMsgObj(){return this._lastMsgObj}get isPinning(){return!!this._isPinning}get isDeleting(){return!!this._isDeleting}set chatID(e){}set profileID(e){}set imgSrc(e){}set name(e){}set unreadMsgCount(e){}set pined(e){this._pined=e}set pinedTime(e){this._pinedTime=e}set sortTime(e){}set lastSeen(e){}set recieverIsOnline(e){}set lastSeenString(e){}set lastMsgObj(e){this._lastMsgObj=new LastMsgInstance(e)}set isPinning(e){this._isPinning=!!e}set isDeleting(e){this._isDeleting=!!e}getChat(){return this}}class ChatsDBInstance{constructor(){this._chats={},this._activeChat,this._gotAllChats,this._searchingChats,this._isSelectingChats}get chats(){return this._chats}get activeChat(){return this._activeChat}get chatsCount(){return this.getChatsAsArr().length}get gotAllChats(){return this._gotAllChats}get searchingChats(){return this._searchingChats}get isSelectingChats(){return this._isSelectingChats}set chats(e){}set activeChat(e){e||(this._activeChat=!1),this._activeChat=ChatBody.makeChatID_DB_Usable(e)}set chatsCount(e){}set gotAllChats(e){!0!==e&&"true"!==e||(this._gotAllChats=!0)}set searchingChats(e){this._searchingChats=!0===e||"true"===e}set isSelectingChats(e){this._isSelectingChats=!0===e||"true"===e}addChat(e){return this.chats[e.chatID]||(this._chats[e.chatID]=new ChatInstance(e)),this.chats[e.chatID]}deleteChat(e){const t=ChatBody.makeChatID_DB_Usable(e);return delete this.chats[t],!this.chats[t]&&(MessagesDB.deleteChat(t),!0)}get sortedChats(){return Object.values(this.chats).sort(((e,t)=>t.sortTime-e.sortTime))}set sortedChats(e){}getNextDBChatID(e,t=!1){e=ChatBody.makeChatID_DB_Usable(e);let s=this.sortedChats,a=0,n=!1,o=-1;for(;a<s.length&&!n;){if(s[a].chatID==e)if(n=!0,o=-2,t){let e=a+1,t=!1;for(;e<s.length&&!t;){let a=s[e].chatID;a=ChatBody.makeChatIDUsable(a),document.getElementById(a)&&(t=!0,o=s[e].chatID),e++}}else s[a+1]&&(o=s[a+1].chatID);a++}return o}setChatPinedStatus(e,t,s=Date.parse(new Date)){t||(s=null);const a=ChatBody.makeChatID_DB_Usable(e);this.chats[a].pined=t,this.chats[a].pinedTime=s}setChatLastMsgObj(e,t){const s=ChatBody.makeChatID_DB_Usable(e);this.chats[s].lastMsgObj=t}setChatIsPinning(e,t){const s=ChatBody.makeChatID_DB_Usable(e);this.chats[s].isPinning=t}setChatIsDeleting(e,t){const s=ChatBody.makeChatID_DB_Usable(e);this.chats[s].isDeleting=t}chatIsPinning(e){const t=ChatBody.makeChatID_DB_Usable(e);return this.chats[t].isPinning}chatIsDeleting(e){const t=ChatBody.makeChatID_DB_Usable(e);return this.chats[t].isDeleting}getChatImage(e){const t=ChatBody.makeChatID_DB_Usable(e);return this.chats[t].imgSrc}getChatName(e){const t=ChatBody.makeChatID_DB_Usable(e);return console.log(this),this.chats[t].name}getChatUnreadMsgCount(e){const t=ChatBody.makeChatID_DB_Usable(e);return this.chats[t].unreadMsgCount}getChatPinedStatus(e){const t=ChatBody.makeChatID_DB_Usable(e);return this.chats[t].pined}getChatLastMsgObj(e){const t=ChatBody.makeChatID_DB_Usable(e);return this.chats[t].lastMsgObj}getChatLastSeen(e){const t=ChatBody.makeChatID_DB_Usable(e);return this.chats[t].lastSeen}getChatLastSeenString(e){const t=ChatBody.makeChatID_DB_Usable(e);return this.chats[t].lastSeenString}recieverIsOnline(e){const t=ChatBody.makeChatID_DB_Usable(e);return this.chats[t].recieverIsOnline}chatObjIsAvailable(e){const t=ChatBody.makeChatID_DB_Usable(e);let s=this.chats[t];return!!s&&!!s.chatID}getChatObj(e){const t=ChatBody.makeChatID_DB_Usable(e);return this.chats[t]}getChatsAsArr(){return Object.values(this.chats)}getAllProfileIDs(){let e=this.getChatsAsArr(),t=[];return e.forEach((e=>{t.push(e.profileID)})),t}}const ChatsDB=new ChatsDBInstance;class ChatBody{static loadChatMessages(e){if(GlobalVars.chatsAreSelected)return;let t=e.target,s=t.classList,a=t;if(!a.dataset.id)for(;!a.dataset.id;)a=a.parentElement;let n=a.dataset.id,o=document.getElementById(n);if(!o)return;if(!ChatContainDOM.isSelectable(o))return;o.removeEventListener("touchend",ChatBody.loadChatMessages),o.removeEventListener("touchcancel",ChatBody.loadChatMessages);const l=["nameSubContain","chatSubContain","lMeg"];let r=!1,i=0;for(;i<l.length&&!r;)s.contains(l[i])&&(r=!0),i++;if(!r)return;let c=ChatsDB.activeChat;if(ChatBody.makeChatID_DB_Usable(c)==ChatBody.makeChatID_DB_Usable(n))return;MsgSectionDOM.clear(),ChatsDB.activeChat=n;const d=DOMGetter.getMessage();let g=DOMGetter.getLoaderBackgroundElem(d),h=DOMGetter.getContentLoaderElem(d);g||LoaderBackgroundDOM.append(d,LoaderBackgroundDOM.create()),h||ContentLoaderDOM.append(d,ContentLoaderDOM.create(!0,"boxes")),MsgSectionDOM.load(),MessageFuncs.pushMessagesIn(n),MessageFuncs.pushMsgSendingIn(n);let M=UnseenMsgIDs.get(n,!0);M?MsgBody.jumpToMsgByID(M):MsgBody.jumpToBottom(),MsgBody.checkIfUnseenMsgsAreSeenOnload(n),DOMGetter.getMessageBody().addEventListener("scroll",MsgBody.scrlMsgBodyToSeeMsg),g=DOMGetter.getLoaderBackgroundElem(d),h=DOMGetter.getContentLoaderElem(d),g&&LoaderBackgroundDOM.delete(d),h&&ContentLoaderDOM.delete(d)}static selectUnselectChat(e){const t=DOMGetter.getChatHeadCount();let s=e.target.dataset.id,a=document.getElementById(s),n=a.getElementsByClassName("chatSelect")[0];if(!ChatContainDOM.isSelectable(a))return;ChatBody.updateSelectedChatsID(s)?(n&&ChatSelectedIconDOM.delete(s),a.style.background="#F5F5F5",ChatSelectedIconDOM.append(s,ChatSelectedIconDOM.create())):(a.style.background="",ChatSelectedIconDOM.delete(s)),t.innerHTML=GlobalVars.selectedChatsID.length;const o=Settings.ChatOptions,l=DOMGetter.getChatHeadPin(),r=DOMGetter.getChatHeadDelete();GlobalVars.selectedChatsID.length>1?(o.groupChatPin?l||ChatHeadSelectedDOM.appendIcon(ChatHeadSelectedDOM.createChatPinIcon()):l&&ChatHeadSelectedDOM.deleteIcon(l),o.groupDelChat?r||ChatHeadSelectedDOM.appendIcon(ChatHeadSelectedDOM.createChatDelIcon()):r&&ChatHeadSelectedDOM.deleteIcon(r)):(o.pinChat&&(l||ChatHeadSelectedDOM.appendIcon(ChatHeadSelectedDOM.createChatPinIcon())),o.deleteChat&&(r||ChatHeadSelectedDOM.appendIcon(ChatHeadSelectedDOM.createChatDelIcon())))}static touchedThisChatThenDrag(e){const t=DOMGetter.getChatBody();clearTimeout(GlobalVars.megChatTouchedTimeOut);let s=t.getBoundingClientRect(),a=e.touches[0].clientY,n=GlobalVars.touchYPos-a;s.top<=a&&s.bottom>=a&&t.scrollTo(t.scrollLeft,t.scrollTop+n),GlobalVars.touchYPos=a}static touchedThisChat(e){e.preventDefault();const t=DOMGetter.getChatHeadCount();GlobalVars.touchYPos=e.touches[0].clientY;let s=e.target;if(!s.dataset.id)for(;!s.dataset.id;)s=s.parentElement;let a=s.dataset.id,n=document.getElementById(a);GlobalVars.chatsAreSelected||(n.addEventListener("touchend",ChatBody.loadChatMessages),n.addEventListener("touchcancel",ChatBody.loadChatMessages)),GlobalVars.chatsAreSelected||(GlobalVars.megChatTouchedTimeOut=setTimeout((()=>{let s=document.getElementById(a);ChatContainDOM.isSelectable(s)&&(s.getElementsByClassName("chatSelect")[0]&&ChatSelectedIconDOM.delete(a),s.removeEventListener("touchend",ChatBody.loadChatMessages),s.removeEventListener("touchcancel",ChatBody.loadChatMessages),ChatGroupActivations.allChatSelected(),ChatGroupDeactivations.removeAllChatHoverEffect(),s.style.background="#F5F5F5",ChatSelectedIconDOM.append(a,ChatSelectedIconDOM.create()),ChatBody.updateSelectedChatsID(a),t.innerHTML=GlobalVars.selectedChatsID.length,e.target.removeEventListener("touchend",OtherFunctions.clearMegChatTouchedTimeOut),e.target.removeEventListener("touchcancel",OtherFunctions.clearMegChatTouchedTimeOut),e.target.removeEventListener("touchmove",ChatBody.touchedThisChatThenDrag))}),1e3)),e.target.addEventListener("touchend",OtherFunctions.clearMegChatTouchedTimeOut),e.target.addEventListener("touchcancel",OtherFunctions.clearMegChatTouchedTimeOut),e.target.addEventListener("touchmove",ChatBody.touchedThisChatThenDrag)}static updateSelectedChatsID(e){e=ChatBody.makeChatIDUsable(e);let t=GlobalVars.selectedChatsID.indexOf(e),s=!1;return t<0?(GlobalVars.selectedChatsID.push(e),s=!0):GlobalVars.selectedChatsID.splice(t,1),s}static emptySelectedChatsID(){GlobalVars.selectedChatsID&&GlobalVars.selectedChatsID.splice(0,GlobalVars.selectedChatsID.length)}static makeChatIDUsable(e){return/chat/.test(e)||(e="chat-"+e),e}static makeChatID_DB_Usable(e){return/chat/.test(e)&&(e=e.split("chat-").splice(-1)[0]),e}}class GenerateAPIRes{static deleteMessageRes(e,t,s){const a=[1,2,3,4,null],n=[];return t.forEach((e=>{const t={msgID:e,delCodeNo:a[Math.round(4*Math.random())]};n.push(t)})),{chatID:e,delCodeNoArr:n}}static deleteChatRes(e){const t=[1,2,3,4,null],s=[];return e.forEach((e=>{const a={chatID:e.chatID,isDeleted:t[Math.round(4*Math.random())]};s.push(a)})),s}static pinChatRes(e){const t=[];return e.forEach((e=>{e=ChatBody.makeChatIDUsable(e);let s=!0;document.getElementById(e).getElementsByClassName("lMegContain2")[0].getElementsByClassName("chatPined")[0]&&(s=!1);const a={chatID:e,pinStatus:s,pinedTime:Date.parse(new Date)};t.push(a)})),t}static starMsgRes(e,t){const s={chatID:ChatBody.makeChatID_DB_Usable(e),result:[]};return t.forEach((t=>{let a=!0;MessageFuncs.getMessageObj(e,t).stared&&(a=!1);const n={msgID:t,starStatus:a};s.result.push(n)})),s}static msgSentSignalRes(e){let t=GenerateDummyDatabase.messages(e.chatID,null,!0,!1,e);return t.msgSendingID=e.msgSendingID,t}}class UnseenMsgIDs{static add(e,t){const s=ChatBody.makeChatID_DB_Usable(e);t=MsgBody.makeMsgID_DB_Usable(t),MessagesDB.unseenMsgIDs[s]||(MessagesDB.unseenMsgIDs[s]=[]),MessagesDB.unseenMsgIDs[s].indexOf(t)<0&&MessagesDB.unseenMsgIDs[s].push(t)}static remove(e,t){const s=ChatBody.makeChatID_DB_Usable(e);if(t=MsgBody.makeMsgID_DB_Usable(t),!MessagesDB.unseenMsgIDs[s])return;let a=MessagesDB.unseenMsgIDs[s].indexOf(t);a>=0&&MessagesDB.unseenMsgIDs[s].splice(a,1)}static get(e,t=!1){const s=ChatBody.makeChatID_DB_Usable(e);return t?MessagesDB.unseenMsgIDs[s]?MessagesDB.unseenMsgIDs[s][0]:void 0:MessagesDB.unseenMsgIDs[s]}static count(e){const t=ChatBody.makeChatID_DB_Usable(e);return MessagesDB.unseenMsgIDs[t].length}}class MessageFuncs{static async fetchOldMsgs(e,t=null){const s=ChatBody.makeChatID_DB_Usable(e),a=MessageFuncs.getFirstMsgInDBID(s),n=Settings.ApiSettings.messagesPerAPICall;if(MessagesDB.gotAllMsgs(s))return null;if(t=MsgBody.makeMsgID_DB_Usable(t)){const e=DOMGetter.getMessage();let t=DOMGetter.getLoaderBackgroundElem(e),s=DOMGetter.getContentLoaderElem(e);t||LoaderBackgroundDOM.append(e,LoaderBackgroundDOM.create()),s||ContentLoaderDOM.append(e,ContentLoaderDOM.create(!0,"boxes"))}let o=await MsgApis.fetchOldMsgs(e,t,a,n);if(!o)return alert("err"),void console.log("err");if(o.length<n&&(MessagesDB.gotAllMsgsStatus[s]=!0),o=o.sort(((e,t)=>t.msgID-e.msgID)),o.forEach((e=>{MessagesDB.addOldMessage(s,e)})),t){const e=DOMGetter.getMessage();let t=DOMGetter.getLoaderBackgroundElem(e),s=DOMGetter.getContentLoaderElem(e);t&&LoaderBackgroundDOM.delete(e),s&&ContentLoaderDOM.delete(e)}}static pushInNewMsg(e,t,s){if(!ChatFuncs.isActiveChat(e)){let e="some error occoured",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}if(t==s){let e="some error occoured",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}if(s.dateSentString!=t.dateSentString&&MsgDateDOM.append(MsgDateDOM.create(t.dateSentString)),t.deleted)DeletedMsgDOM.append(DeletedMsgDOM.create(t));else{let e=MsgWraperDOM.create(t);MessageFuncs.isSelectingMsgs()&&MsgGroupActivations.allSelected_Megchecked(e),MsgWraperDOM.append(e)}const a=t.msgID,n=MsgBody.msgIsSeeable(a);if(null!==n)n&&MessageFuncs.sendMsgSeenSignal(e,a);else{let e="mg id not found",t="",s=MyCodeErr.announce(e,t);s&&console.log(s)}}static pushInMsgSending(e,t){if(!ChatFuncs.isActiveChat(e)){let e="ome error occoured",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}let s,a=!1;MsgOnSendingDB.hasMsgSending(e)&&(a=!0,s=MsgOnSendingDB.getChatMsgOnSendingAsArr(e),s=s.filter((e=>e.date<t.date)),s=s[s.length-1],s||(a=!1)),a||(s=MessageFuncs.getChatMsgsAsArr(e),s=s[s.length-1]),s.dateSentString!=t.dateSentString&&MsgDateDOM.append(MsgDateDOM.create(t.dateSentString)),MsgSendingWraperDOM.append(MsgSendingWraperDOM.create(t))}static pushMessagesIn(e){const t=ChatBody.makeChatID_DB_Usable(e);if(MessagesDB.messages[t]||(console.log("pushMessagesIn, no run"),MessageFuncs.fetchMessages(e)),!ChatFuncs.isActiveChat(e))return;let s=UnseenMsgIDs.get(t,!0);s||(s=0);let a=MessageFuncs.getChatMsgsAsArr(e);a=a.sort(((e,t)=>t.msgID-e.msgID));let n,o=0,l=0,r=null,i=!1,c=!1;for(;!c&&l<a.length;){let e,t=a[l];if(n=t,o=t.msgID,s?(i=o<=s,c=i&&l>9):c=l>=9,!l){t.deleted?(e=DeletedMsgDOM.create(t),DeletedMsgDOM.append(e)):(e=MsgWraperDOM.create(t),MessageFuncs.isSelectingMsgs()&&MsgGroupActivations.allSelected_Megchecked(e),MsgWraperDOM.append(e)),l++,r=e;continue}let d=a[l-1].dateSentString;d!=t.dateSentString&&(e=MsgDateDOM.create(d),MessageBodyDOM.appendElemBeforeElem(e,r),r=e),t.deleted?(e=DeletedMsgDOM.create(t),MessageBodyDOM.appendElemBeforeElem(e,r)):(e=MsgWraperDOM.create(t),MessageFuncs.isSelectingMsgs()&&MsgGroupActivations.allSelected_Megchecked(e),MessageBodyDOM.appendElemBeforeElem(e,r)),r=e,l++}if(n){let e=MsgDateDOM.create(n.dateSentString);MessageBodyDOM.appendElemBeforeElem(e,r),r=e}DOMGetter.getLoadOlderMsgsBtn()&&LoadOlderMsgsBtnDOM.delete(),a.length>10&&LoadOlderMsgsBtnDOM.append(LoadOlderMsgsBtnDOM.create()),OtherFunctions.activateMsgDateBeforeAfterfunc()}static pushMsgSendingIn(e){const t=ChatBody.makeChatID_DB_Usable(e);if(!MsgOnSendingDB.hasMsgSending(t))return;if(!ChatFuncs.isActiveChat(t))return;let s=MessageFuncs.getChatMsgsAsArr(e);s=s[s.length-1];let a=MsgOnSendingDB.getChatMsgOnSendingAsArr(e),n=0;a.forEach((t=>{n&&(s=MsgOnSendingDB.getChatMsgOnSendingAsArr(e),s=s.filter((e=>e.date<t.date)),s=s[s.length-1]),s.dateSentString!=t.dateSentString&&MsgDateDOM.append(MsgDateDOM.create(t.dateSentString)),MsgSendingWraperDOM.append(MsgSendingWraperDOM.create(t)),n++}))}static async pushInPreviousMsgs(e,t=null){const s=ChatBody.makeChatID_DB_Usable(e),a=MsgBody.getFirstMsgOnDomId();if(!MessageFuncs.isValidMsgID(s,a)){let e="some error occured",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}const n=MsgBody.getElemAbsolutePos(a,!0);if(!ChatFuncs.isActiveChat(s))return;let o=MessageFuncs.getChatMsgsAsArr(s);if(o=o.sort(((e,t)=>t.msgID-e.msgID)),o=o.filter((e=>e.msgID<a)),t||MessagesDB.gotAllMsgs(s)||o.length<10&&(await MessageFuncs.fetchOldMsgs(s),o=MessageFuncs.getChatMsgsAsArr(s),o=o.sort(((e,t)=>t.msgID-e.msgID)),o=o.filter((e=>e.msgID<a))),t){if(MessageFuncs.isValidMsgID(s,t)||await MessageFuncs.fetchOldMsgs(s,t),!MessageFuncs.isValidMsgID(s,t)){let e="some error occured",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}o=MessageFuncs.getChatMsgsAsArr(s),o=o.sort(((e,t)=>t.msgID-e.msgID)),o=o.filter((e=>e.msgID<a))}if(!o[0]){let e="some error occured",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}let l,r,i=0,c=o[0].msgID+1,d=null,g=MessageFuncs.getMessageObj(s,a);if(g&&(MsgDateDOM.deleteFirstOnPage(),d=MsgWraperDOM.create(g),MessageFuncs.isSelectingMsgs()&&(MsgGroupActivations.allSelected_Megchecked(d),MsgBody.msgIsSelected(g.msgID)&&MessageBodyDOM.markAsSelected(d,s)),MsgWraperDOM.replace(a,d),o[0].dateSentString!=g.dateSentString)){let e=MsgDateDOM.create(g.dateSentString);MessageBodyDOM.appendElemBeforeElem(e,d),d=e}for(r=t?t<c:i<10&&i<o.length;r;){let e,s=o[i];if(l=s,c=l.msgID,i){let t=o[i-1].dateSentString;t!=s.dateSentString&&(e=MsgDateDOM.create(t),MessageBodyDOM.appendElemBeforeElem(e,d),d=e)}s.deleted?(e=DeletedMsgDOM.create(s),MessageBodyDOM.appendElemBeforeElem(e,d)):(e=MsgWraperDOM.create(s),MessageFuncs.isSelectingMsgs()&&MsgGroupActivations.allSelected_Megchecked(e),MessageBodyDOM.appendElemBeforeElem(e,d)),d=e,i++,r=t?t<c:i<10&&i<o.length}if(l){let e=MsgDateDOM.create(l.dateSentString);MessageBodyDOM.appendElemBeforeElem(e,d),d=e}DOMGetter.getLoadOlderMsgsBtn()&&LoadOlderMsgsBtnDOM.delete(),o.length>10&&LoadOlderMsgsBtnDOM.append(LoadOlderMsgsBtnDOM.create()),MsgBody.setElemAbsolutePos(n,a,!0),OtherFunctions.activateMsgDateBeforeAfterfunc()}static addMessage(e,t,s){const a=ChatBody.makeChatID_DB_Usable(e);MessagesDB.addMessage(a,t,s)}static getFirstMsgInDBID(e){const t=MessageFuncs.getChatMsgsAsArr(e)[0];if(!t){let e="some error occured",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}return t.msgID||null}static updateReadStatus(e,t,s,a){const n=ChatBody.makeChatID_DB_Usable(e);if(MessagesDB.setReadStatus(n,t,s,a),UpdateMsgDOM.readElem(e,t),MessageFuncs.isLastMsgInDB(e,t)){const s=MessageFuncs.getMessageObj(e,t);ChatFuncs.updateChatLastMsgObj(e,s)}}static updateStaredStatus(e,t,s){const a=ChatBody.makeChatID_DB_Usable(e);MessagesDB.setStaredStatus(a,t,s),UpdateMsgDOM.starElem(e,t)}static updateDeliverTime(e,t,s){const a=ChatBody.makeChatID_DB_Usable(e);MessagesDB.setDeliverTime(a,t,s)}static correctFirstStatus(e,t){const s=ChatBody.makeChatID_DB_Usable(e),a=MessageFuncs.getMessageObj(s,t);let n=MessageFuncs.getChatMsgsAsArr(s);n=n.filter((e=>e.msgID<t)),n=n[n.length-1],a.first=a.senderID!=n.senderID||a.dateSentString!=n.dateSentString}static getMsgSenderClass(e,t){const s=ChatBody.makeChatID_DB_Usable(e);return MessagesDB.getSenderClass(s,t)}static getMessageObj(e,t){const s=ChatBody.makeChatID_DB_Usable(e);return MessagesDB.getMessageObj(s,t)}static getRepliedMsgObj(e,t){const s=ChatBody.makeChatID_DB_Usable(e);return MessagesDB.getMessageObj(s,t).replyedMegObj||null}static setMsgInfoInView(e,t){const s=ChatBody.makeChatID_DB_Usable(e);MessagesDB.setMsgInfoInView(s,t)}static setMsgIsStaring(e,t,s){MessagesDB.setMsgIsStaring(e,t,s)}static setMsgIsDeleting(e,t,s){MessagesDB.setMsgIsDeleting(e,t,s)}static msgIsStaring(e,t){return MessagesDB.msgIsStaring(e,t)}static msgIsDeleting(e,t){return MessagesDB.msgIsDeleting(e,t)}static isSelectingMsgs(){return MessagesDB.isSelectingMsgs}static setIsSelectingMsgs(e){MessagesDB.isSelectingMsgs=e}static deleteMessage(e,t,s){const a=ChatBody.makeChatID_DB_Usable(e);if(s&&(MessagesDB.deleteMessage(a,t,s),UpdateMsgDOM.deletedMsgElem(a,t),MessageFuncs.isLastMsgInDB(e,t))){const s=MessageFuncs.getMessageObj(e,t);console.log(s),ChatFuncs.updateChatLastMsgObj(e,s)}}static isLastMsgInDB(e,t){const s=ChatBody.makeChatID_DB_Usable(e);return MessagesDB.isLastMsgInDB(s,t)}static getChatMsgsAsArr(e){const t=ChatBody.makeChatID_DB_Usable(e);return MessagesDB.getChatMsgsAsArr(t)}static isValidMsgID(e,t){return MessagesDB.getMessageObj(e,t,!0)}static convertMsgSendingToMsg(e){const t=e.chatID,s=e.msgSendingID,a=e.msgID;if(MessagesDB.convertMsgSendingToMsg(e),ChatFuncs.isActiveChat(t)){let e=MessageFuncs.getMessageObj(t,a);if(!e){let e="unale to create newMsgInstannce",t="",s=MyCodeErr.announce(e,t);return void(s&&console.log(s))}let n=MsgWraperDOM.create(e);MessageFuncs.isSelectingMsgs()&&MsgGroupActivations.allSelected_Megchecked(n),MsgSendingWraperDOM.convertToMsg(s,n)}}static sendMsgSeenSignal(e,t,s=!1){if(!s||ChatFuncs.isActiveChat(e)){if(s){const s=MessagesDB.getChatMessages(e),a=UnseenMsgIDs.get(e);let n=0,o=0;for(;n<a.length&&o<t;){let t=s[a[n]];o=t.msgID,"read"==t.read||t.isSender||(MessagesDB.setReadStatus(e,o,"read",null),UnseenMsgIDs.remove(e,o)),n++}}else{let s=MessagesDB.getMessageObj(e,t);"read"==s.read||s.isSender||(MessagesDB.setReadStatus(e,t,"read",null),UnseenMsgIDs.remove(e,t))}ChatFuncs.updateChatUnreadMsgCount(e)}}static recieveMsgSentSignal(e){e.chatID,e.msgSendingID,MessageFuncs.convertMsgSendingToMsg(e)}static sendMsg(e){const t={userID:MyProfile.userID,chatID:e.chatID,msgSendingID:e.msgSendingID,msg:e.msg};e.rMsg&&(t.rMsgId=e.rMsg.msgID);let s=GenerateAPIRes.msgSentSignalRes(t);setTimeout((()=>{MessageFuncs.recieveMsgSentSignal(s)}),3e3)}static msgDelSignal(){}}class GenerateDummyDatabase{static chatName(){let e="abcdefghijklmnoopqrstuvwxyz",t="abcdefghijklmnoopqrstuvwxyz",s=Math.round(23*Math.random()),a=Math.ceil(10*Math.random())+1;return e=e.substr(s,a),s=Math.round(23*Math.random()),a=Math.ceil(10*Math.random())+1,t=t.substr(s,a),e+" "+t}static msgText(e=10){let t="",s=Math.round(Math.random()*e);for(let e=0;e<s;e++){let s="abcdefghijklmnoopqrstuvwxyz",a=Math.round(23*Math.random()),n=Math.round(5*Math.random())+1;s=s.substr(a,n),t+=e?" "+s:s}return t}static lastMsgObj(){let e={};return e.lastMsg=Math.round(1e4*Math.random()),e.lastMsg=GenerateDummyDatabase.msgText(),e.timeSent=Math.round(15890652e5*Math.random())+5e11,e.read="sent",e.isSender=Math.round(1*Math.random()),e}static replyedMegObj(e){let t=Math.round(1*Math.random());return t?(t={},t.chatID=e,t.msgID=1,t.isSender=Math.round(1*Math.random()),t.msg=GenerateDummyDatabase.msgText(),t.senderName=GenerateDummyDatabase.chatName(),t):null}static chatsAndProfiles(e,t=!1){let s=[],a=[];return e.forEach((e=>{let n={};n.chatID=e,n.profileID=e,n.pined=Math.round(1*Math.random()),t&&(n.pined=!1),n.lastMsgObj=GenerateDummyDatabase.lastMsgObj(),n.pined?(n.pinedTime=Math.round(15890652e5*Math.random())+5e11,n.sortTime=n.pinedTime):n.sortTime=n.lastMsgObj.timeSent;let o=GenerateDummyDatabase.messages(e,[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]);n.messages=o,s.push(n);let l=GenerateDummyDatabase.profile([n.chatID,n.profileID]);a.push(l)})),{chats:s,profiles:a}}static messages(e,t,s=!1,a=!1,n=!1){if(s){let s={};if(s.msgID=t,s.chatID=e,n){let t=MessageFuncs.getChatMsgsAsArr(e);t=t[t.length-1],t=t.msgID,t++,s.msgID=t}return s.msg=n?n.msg:GenerateDummyDatabase.msgText(),s.isSender=Math.round(1*Math.random()),n&&(s.isSender=!0),s.senderID=s.isSender,s.timeSent=Math.round(15890652e5*Math.random())+5e11,s.read=["sent","delivered","read"][Math.floor(3*Math.random())],s.stared=Math.round(1*Math.random()),s.deliverTime=Math.round(15890652e5*Math.random())+5e11,s.readTime=Math.round(15890652e5*Math.random())+5e11,n?n.rMsgID&&(s.replyedMegObj=MessageFuncs.getMessageObj(e,n.rMsgID)):s.replyedMegObj=GenerateDummyDatabase.replyedMegObj(e),s}let o=[];return t.forEach((t=>{let s={};s.chatID=e,s.msgID=t,s.msg=GenerateDummyDatabase.msgText(),s.isSender=Math.round(1*Math.random()),s.senderID=s.isSender,s.timeSent=Math.round(15890652e5*Math.random())+5e11,s.read=a?"read":["sent","delivered","read"][Math.floor(3*Math.random())],s.stared=Math.round(1*Math.random()),s.deliverTime=Math.round(15890652e5*Math.random())+5e11,s.readTime=Math.round(15890652e5*Math.random())+5e11,s.replyedMegObj=GenerateDummyDatabase.replyedMegObj(e),o.push(s)})),o}static profile(e,t=!0){if(!e[0])return;let s={};return s.userID=e[0],t||(s.chatID=e[1]),s.name=GenerateDummyDatabase.chatName(),s.p_pix="default.jpg",s}}class ChatDOMFunc{static moveChatElement(e,t,s=!1){let a=e.parentElement,n=t.parentElement;(s||a==n)&&n.insertBefore(e,t)}static putChatContainElemInPosition(e,t=!1){let s,a,n=!1,o=!1;t?(s=e,s=ChatBody.makeChatIDUsable(s),e=document.getElementById(s)):(s=e.id,o=!e.parentElement,s||(s=e.chatID,s=ChatBody.makeChatIDUsable(s),e=ChatContainDOM.create(e),n=!0)),ChatFuncs.getIsSelectingChats()&&ChatGroupActivations.allChatSelected(e),a=n||o,s=ChatBody.makeChatIDUsable(s);let l=ChatsDB.getNextDBChatID(s);if(-1==l){let e="Chat not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);return void(a&&console.log(a))}if(-2==l){let t=ChatFuncs.getChatsCount(),s=ChatContainDOM.getCountChatContains();if(ChatFuncs.gotAllChatsFromDB()&&!t-s)return void ChatContainDOM.append(e)}l=ChatBody.makeChatIDUsable(l);let r=document.getElementById(l);if(r)ChatDOMFunc.moveChatElement(e,r,a);else{if(l=ChatsDB.getNextDBChatID(s,!0),-1==l){let e="Chat not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);return void(a&&console.log(a))}if(-2==l){let t=ChatFuncs.getChatsCount(),a=ChatContainDOM.getCountChatContains();return ChatFuncs.gotAllChatsFromDB()&&!t-a?void ChatContainDOM.append(e):void ChatContainDOM.delete(s)}l=ChatBody.makeChatIDUsable(l);let t=document.getElementById(l);if(!t){let e="fatal error",t="",s=!1,a=MyCodeErr.announce(e,t,s);return void(a&&(console.log(a),console.log(l)))}ChatDOMFunc.moveChatElement(e,t,a)}}}class UpdateChatDOM{static deleteChatElem(e){e=ChatBody.makeChatIDUsable(e),ChatContainDOM.delete(e)}static imageElem(e){e=ChatBody.makeChatIDUsable(e),document.getElementById(e).getElementsByClassName("chatPix")[0].getElementsByTagName("img")[0].src=ChatsDB.getChatImage(e)}static nameElem(e){e=ChatBody.makeChatIDUsable(e),document.getElementById(e).getElementsByClassName("nameContain")[0].getElementsByClassName("nameSubContain")[0].innerHTML=ChatsDB.getChatName(e)}static chatCountElem(e){e=ChatBody.makeChatIDUsable(e);const t=document.getElementById(e).getElementsByClassName("lMegContain2")[0].getElementsByClassName("chatCount")[0],s=ChatsDB.getChatUnreadMsgCount(e);t&&ChatCountDOM.delete(e),s&&ChatCountDOM.append(e,ChatCountDOM.create(s))}static pinedElem(e){e=ChatBody.makeChatIDUsable(e);const t=document.getElementById(e).getElementsByClassName("lMegContain2")[0].getElementsByClassName("chatPined")[0];ChatsDB.getChatPinedStatus(e)?t||ChatPinedDOM.append(e,ChatPinedDOM.create()):t&&ChatPinedDOM.delete(e),ChatDOMFunc.putChatContainElemInPosition(e,!0)}static lMegElem(e){e=ChatBody.makeChatIDUsable(e);const t=ChatsDB.getChatLastMsgObj(e),s=document.getElementById(e).getElementsByClassName("chatSubContain")[0],a=s.getElementsByClassName("chatTimeContain")[0],n=(s.getElementsByClassName("lMegRead")[0],s.getElementsByClassName("lMeg")[0]);UpdateChatDOM.lMegReadElem(e),a.innerHTML=t.timeSentString,t.deletedText?n.innerHTML=t.deletedText:n.innerHTML=t.lastMsg,ChatDOMFunc.putChatContainElemInPosition(e,!0)}static lMegReadElem(e){e=ChatBody.makeChatIDUsable(e);const t=ChatsDB.getChatLastMsgObj(e),s=document.getElementById(e).getElementsByClassName("chatSubContain")[0].getElementsByClassName("lMegRead")[0];if(s&&LMegReadDOM.delete(e),!t.deletedText&&t.isSender){let a=!1,n="",o=t.read;"read"==o&&(a=!0),n="sent"==o?"done":"done_all",s?(s.innerHTML=n,a?s.classList.add("read"):s.classList.remove("read")):LMegReadDOM.append(e,LMegReadDOM.create(a,n))}}static chatOnlineElem(e){e=ChatBody.makeChatIDUsable(e);let t=document.getElementById(e);if(!t)return;let s=t.getElementsByClassName("chatPix")[0];if(!s){let e="chatPixElem not found",t="",s=!1,a=MyCodeErr.announce(e,t,s);return void(a&&console.log(a))}const a=s.getElementsByClassName("online")[0];ChatFuncs.recieverIsOnline(e)?a||ChatOnlineIconDOM.append(e,ChatOnlineIconDOM.create()):a&&ChatOnlineIconDOM.delete(e)}}class ChatApis{static async fetchChats(e){let t;return Settings.ApiSettings.chatsPerAPICall,t=e?[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,91,98,73,45,46,4626,23,26,267,121,65,684,48,84,374,845,894,487,90,37]:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21],await GenerateDummyDatabase.chatsAndProfiles(t)}static async fetchChatByID(e){let t=[ChatBody.makeChatID_DB_Usable(e)];return await GenerateDummyDatabase.chatsAndProfiles(t)}static async fetchOlderChats(e){return await GenerateDummyDatabase.chatsAndProfiles([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,111,112,113,114,115,116,117,118,119,1110,1111,1112,1113,1114,1115,1116,1117,1118,1119,1120],!0)}static deleteChat(e){let t=[];if(e.forEach((e=>{if(ChatFuncs.chatIsDeleting(e))return;ChatFuncs.setChatIsDeleting(e,!0),ChatContainDOM.makeUnselectable(e),ChatMoreOptionsDOM.makeOptionUclickale(e,"del");let s={chatID:ChatBody.makeChatID_DB_Usable(e),lastMsgID:ChatFuncs.getChatLastMsgObj(e).msgID};t.push(s)})),!t.length)return void console.log("err");let s=GenerateAPIRes.deleteChatRes(t);s?chatApis_ApiSuccess.deleteChat(s):chatApis_ApiFail.deleteChat(t)}static pinChat(e){let t=[];if(e.forEach((e=>{ChatFuncs.chatIsPinning(e)||(ChatFuncs.setChatIsPinning(e,!0),ChatMoreOptionsDOM.makeOptionUclickale(e,"pin"),t.push(ChatBody.makeChatID_DB_Usable(e)))})),!t.length)return void console.log("err");let s=GenerateAPIRes.pinChatRes(t);s?chatApis_ApiSuccess.pinChat(s):chatApis_ApiFail.pinChat(t)}}class chatApis_ApiSuccess{static deleteChat(e){e.forEach((e=>{if(e.isDeleted){let t=e.chatID;ChatFuncs.deleteChat(t),ChatFuncs.isActiveChat(t)&&MsgSectionDOM.clear(!0)}else{let t=e.chatID;ChatFuncs.setChatIsDeleting(t,!1),ChatContainDOM.makeSelectable(t),ChatMoreOptionsDOM.makeOptionClickale(t,"del"),alert("chat not deleted"),console.log("chat not deleted")}}))}static pinChat(e){e.forEach((e=>{let t=e.chatID,s=e.pinedTime,a=e.pinStatus;ChatFuncs.setChatIsPinning(t,!1),ChatMoreOptionsDOM.makeOptionClickale(t,"pin"),ChatFuncs.updateChatPinedStatus(t,a,s)}))}}class chatApis_ApiFail{static deleteChat(e){e.forEach((e=>{e=e.chatID,ChatFuncs.setChatIsDeleting(e,!1),ChatContainDOM.makeSelectable(e),ChatMoreOptionsDOM.makeOptionClickale(e,"del")}));let t=MyCodeErr.announce("Poor internet connection","");t&&console.log(t)}static pinChat(e){e.forEach((e=>{ChatFuncs.setChatIsPinning(e,!1),ChatMoreOptionsDOM.makeOptionClickale(e,"pin")}));let t=MyCodeErr.announce("Poor internet connection","");t&&console.log(t)}}class ChatFuncs{static async fetchChats(e=!1){if(e){if(ChatsDB.gotAllChats)return}else if(Object.keys(ChatsDB.chats).length)return;const t=await ChatApis.fetchChats(e);if(!t.chats)return alert("err"),void console.log("err");const s=Settings.ApiSettings.chatsPerAPICall,a=t.chats,n=t.profiles;e&&(ChatsDB.gotAllChats=!0),a.length<s&&!e&&(ChatsDB.gotAllChats=!0),a.forEach((e=>{ChatsDB.addChat(e)})),n.forEach((e=>{ProfilesDB.addProfile(e)}))}static async fetchChatByID(e){const t=await ChatApis.fetchChatByID(e);if(!t.chats)return alert("err"),void console.log("err");let s=t.chats,a=t.profiles,n=s[0],o=a[0];ProfilesDB.addProfile(o);let l=ChatsDB.addChat(n);if(!ChatFuncs.isInSearchMode()){if(!ChatContainDOM.getAllChatContains()[0])return;ChatDOMFunc.putChatContainElemInPosition(ChatContainDOM.create(l))}}static async fetchOlderChats(){if(ChatFuncs.gotAllChatsFromDB())return LoadOlderChatsDOM.delete(),void ChatFuncs.pushInFetchedChat(!0);const e=DOMGetter.getGetOlderChat();LoaderBackgroundDOM.append(e,LoaderBackgroundDOM.create()),ContentLoaderDOM.append(e,ContentLoaderDOM.create(!0,"boxes"));const t=Settings.ApiSettings.chatsPerAPICall;let s=ChatFuncs.getChatsCount();if(s>=ChatContainDOM.getCountChatContains()+t)return LoadOlderChatsDOM.delete(),void ChatFuncs.pushInFetchedChat(!0);let a=2*t+s;const n=await ChatApis.fetchOlderChats(a);if(!n.chats)return alert("err"),void console.log("err");let o=n.chats,l=n.profiles;o.length<a&&(ChatsDB.gotAllChats=!0),o.forEach((e=>{ChatFuncs.chatObjIsAvailable(e.chatID)||ChatsDB.addChat(e)})),l.forEach((e=>{ProfilesDB.profileObjIsAvailable(e.userID)||ProfilesDB.addProfile(e)}))}static pushInFetchedChat(e=!1){const t=Settings.ApiSettings.chatsPerAPICall;let s=ChatsDB.sortedChats,a=0,n=0;for(;a<s.length&&n<t;){let t=s[a];if(e){let e=t.chatID;e=ChatBody.makeChatIDUsable(e),document.getElementById(e)||(ChatDOMFunc.putChatContainElemInPosition(t),n++)}else{let e=ChatContainDOM.create(t);ChatFuncs.getIsSelectingChats()&&ChatGroupActivations.allChatSelected(e),ChatContainDOM.append(e),n++}a++}ChatFuncs.getChatsCount()-ChatContainDOM.getCountChatContains()&&LoadOlderChatsDOM.append(LoadOlderChatsDOM.create())}static deleteChat(e){ChatsDB.deleteChat(e)&&UpdateChatDOM.deleteChatElem(e)}static updateChatImage(e){UpdateChatDOM.imageElem(e)}static updateChatName(e){UpdateChatDOM.nameElem(e)}static updateChatUnreadMsgCount(e){UpdateChatDOM.chatCountElem(e)}static updateChatPinedStatus(e,t,s=Date.parse(new Date)){ChatsDB.setChatPinedStatus(e,t,s),UpdateChatDOM.pinedElem(e)}static updateChatLastMsgObj(e,t){ChatsDB.setChatLastMsgObj(e,t),UpdateChatDOM.lMegElem(e)}static updateChatLastSeen(e){UpdateMsgDOM.messageHeadLastSeenElem(e),UpdateChatDOM.chatOnlineElem(e)}static getActiveChat(){return ChatsDB.activeChat}static getChatObj(e){return ChatsDB.getChatObj(e)}static getChatLastMsgObj(e){return ChatsDB.getChatLastMsgObj(e)}static getChatLastSeen(e){return ChatsDB.getChatLastSeen(e)}static getChatLastSeenString(e){return ChatsDB.getChatLastSeenString(e)}static setActiveChat(e){ChatsDB.activeChat=e}static isActiveChat(e){return ChatBody.makeChatID_DB_Usable(e)==ChatsDB.activeChat}static recieverIsOnline(e){return ChatsDB.recieverIsOnline(e)}static chatObjIsAvailable(e){return ChatsDB.chatObjIsAvailable(e)}static gotAllChatsFromDB(){return ChatsDB.gotAllChats}static getChatsCount(){return ChatsDB.chatsCount}static getIsSelectingChats(){return ChatsDB.isSelectingChats}static setIsSelectingChats(e){ChatsDB.isSelectingChats=e}static setSearchingMode(e){ChatsDB.searchingChats=e}static setChatIsPinning(e,t){ChatsDB.setChatIsPinning(e,t)}static setChatIsDeleting(e,t){ChatsDB.setChatIsDeleting(e,t)}static chatIsPinning(e){return ChatsDB.chatIsPinning(e)}static chatIsDeleting(e){return ChatsDB.chatIsDeleting(e)}static isInSearchMode(){return ChatsDB.searchingChats}static delChatSignal(){}}class ChatSectionDOM{static clear(){let e=DOMGetter.getChat().children;if(e){let t=e.length;for(let s=0;s<t;s++)e[0].parentNode.removeChild(e[0])}else{let e="counld not get allChatSectionContent",t="",s=!1,a=MyCodeErr.announce(e,t,s);a&&console.log(a)}}static load(){ChatHeadDOM.append(ChatHeadDOM.create()),ChatHeadNormalDOM.append(ChatHeadNormalDOM.create(MyProfile.p_pix)),ChatHeadSelectedDOM.append(ChatHeadSelectedDOM.create()),ChatBodyDOM.append(ChatBodyDOM.create())}}class PageLoadDOM{static async messagesPage(e){await MyProfile.fetch(),await ChatFuncs.fetchChats();const t=DOMGetter.getPageSection();e.forEach((e=>{t.appendChild(e)})),ChatSectionDOM.load(),ChatFuncs.pushInFetchedChat(),SelectAChatDOM.append(SelectAChatDOM.create())}}PageClearDOM.section(),PageLoadDOM.messagesPage(PageCreateDOM.messagesPage())})();